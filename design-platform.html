<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êô∫ËÉΩËøêËê•ËÆæËÆ°ÈÖçÁΩÆÂπ≥Âè∞</title>
    <link rel="stylesheet" href="easydesign-theme.css">
    <script>
        (function(){var t=localStorage.getItem('easydesign_theme')||'dark';document.documentElement.setAttribute('data-theme',t);})();
    </script>
    <style>
        /* ÊóßÂèòÈáèÂÖºÂÆπÊò†Â∞Ñ */
        :root {
            --primary-gold: var(--brand-light);
            --primary-yellow: #C8C8CD;
            --primary-orange: var(--brand);
            --bg-light: var(--bg);
            --bg-white: var(--bg-secondary);
            --bg-dark: #0D1117;
            --text-muted: var(--text-secondary);
            --accent-blue: var(--brand);
            --accent-red: #EF4444;
        }
        [data-theme="light"] {
            --primary-gold: rgba(0, 153, 255, 0.08);
            --primary-yellow: #E5E5EA;
            --primary-orange: #0099FF;
            --bg-light: #F5F7FA;
            --bg-white: #FFFFFF;
            --bg-dark: #1A1A1A;
            --text-muted: rgba(60, 60, 67, 0.6);
            --accent-blue: #0099FF;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'PingFang SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            background-image: 
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-primary);
            min-height: 100vh;
            overflow: hidden;
        }
        [data-theme="light"] body {
            background-image:
                linear-gradient(rgba(0,0,0,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.02) 1px, transparent 1px);
        }
        
        .platform-container { display: flex; flex-direction: column; height: 100vh; }
        
        /* È°∂ÈÉ®Â∑•ÂÖ∑Ê†è */
        .toolbar {
            height: 64px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        [data-theme="light"] .toolbar { box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        
        .toolbar-left { display: flex; align-items: center; gap: 12px; }
        
        .logo {
            width: 32px; height: 32px;
            border-radius: 8px;
            overflow: hidden;
        }
        .logo img {
            width: 100%; height: 100%;
            object-fit: cover;
        }
        
        .toolbar-title { font-size: 16px; font-weight: 600; color: var(--text-primary); }
        .toolbar-center { display: flex; align-items: center; gap: 16px; }
        
        .device-select {
            padding: 8px 32px 8px 12px;
            font-size: 13px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            min-width: 200px;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            cursor: pointer;
        }
        
        .device-select:focus { outline: none; border-color: var(--brand); }
        
        .toolbar-right { display: flex; align-items: center; gap: 10px; }
        
        .toolbar-btn {
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        .toolbar-btn:hover { border-color: var(--brand); color: var(--brand); background: var(--brand-light); box-shadow: 0 0 20px rgba(0, 212, 255, 0.1); transform: translateY(-1px); }
        [data-theme="light"] .toolbar-btn:hover { box-shadow: 0 0 12px rgba(0, 153, 255, 0.06); }
        
        .toolbar-btn.primary {
            background: var(--brand);
            border: none;
            color: #fff;
        }
        
        .toolbar-btn.primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0, 153, 255, 0.4); }
        [data-theme="light"] .toolbar-btn.primary:hover { box-shadow: 0 8px 24px rgba(0, 153, 255, 0.2); }
        .toolbar-btn svg { width: 16px; height: 16px; }
        
        /* ‰∏ªÂÜÖÂÆπÂå∫‰∏âÊ†èÂ∏ÉÂ±Ä */
        .main-content { display: flex; flex: 1; overflow: hidden; }
        
        /* Â∑¶‰æßÁªÑ‰ª∂Èù¢Êùø */
        .left-panel {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        [data-theme="light"] .left-panel { box-shadow: 2px 0 8px rgba(0,0,0,0.04); }
        
        .panel-header { padding: 16px; border-bottom: 1px solid var(--border); }
        .panel-title { font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px; }
        .search-box { position: relative; }
        
        .search-input {
            width: 100%;
            padding: 10px 12px 10px 36px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 13px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .search-input:focus { outline: none; border-color: var(--brand); background: var(--bg-secondary); }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px; height: 16px;
            color: var(--text-muted);
        }
        
        .category-tabs {
            display: flex;
            gap: 6px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            flex-shrink: 0;
        }
        
        .category-tabs::-webkit-scrollbar { display: none; }
        
        .category-tab {
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            cursor: pointer;
            border: none;
            white-space: nowrap;
        }
        
        .category-tab:hover { color: var(--text-primary); background: var(--border); }
        .category-tab.active { background: var(--brand-light); color: var(--brand); }
        
        .component-list { flex: 1; overflow-y: auto; padding: 16px; }
        .component-list::-webkit-scrollbar { width: 4px; }
        .component-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
        
        .component-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        
        .component-card {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 12px;
            cursor: grab;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .component-card:hover { border-color: var(--brand); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 153, 255, 0.15); }
        .component-card:active { cursor: grabbing; }
        .component-card.dragging { opacity: 0.5; }
        
        .component-thumb {
            width: 100%; height: 60px;
            border-radius: 8px;
            margin-bottom: 8px;
            overflow: hidden;
        }
        
        .component-name { font-size: 12px; font-weight: 500; color: var(--text-secondary); text-align: center; }
        
        /* ‰∏≠Èó¥ÁîªÂ∏ÉÂå∫Âüü */
        .center-panel {
            flex: 1;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
            position: relative;
        }
        
        .center-panel::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
        }
        [data-theme="light"] .center-panel::before {
            background-image: 
                linear-gradient(rgba(0,0,0,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.02) 1px, transparent 1px);
        }
        
        .phone-container {
            position: relative;
            background: #1a1a1a;
            border-radius: 45px;
            padding: 10px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .phone-screen {
            width: 375px; height: 812px;
            border-radius: 38px;
            overflow: hidden;
            background: var(--primary-yellow);
            /* ÊâãÊú∫Ê°ÜÂÜÖÂº∫Âà∂ÊµÖËâ≤Ôºå‰∏çÂèóÂ§ñÈÉ®‰∏ªÈ¢òÂΩ±Âìç */
            --bg-tertiary: #F2F2F7;
            --bg-secondary: #FFFFFF;
            --brand-light: rgba(0, 153, 255, 0.08);
            --text-primary: rgba(0, 0, 0, 0.88);
            --text-secondary: rgba(60, 60, 67, 0.6);
            --text-tertiary: rgba(60, 60, 67, 0.36);
            --border: #E5E5EA;
            --primary-gold: rgba(0, 153, 255, 0.08);
        }
        
        .canvas-wrapper { width: 100%; height: 100%; overflow-y: auto; overflow-x: hidden; }
        .canvas-wrapper::-webkit-scrollbar { display: none; }
        
        .canvas-content { min-height: 100%; background: var(--primary-yellow); position: relative; padding-bottom: 20px; }
        
        .canvas-empty {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: rgba(0, 0, 0, 0.3);
        }
        
        .canvas-empty-icon { margin-bottom: 16px; opacity: 0.5; }
        .canvas-empty-text { font-size: 14px; font-weight: 500; }
        
        .canvas-component {
            position: relative;
            margin: 12px 16px;
            background: #fff;
            border-radius: 16px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .canvas-component.hero-component {
            margin: 0;
            border-radius: 0;
            background: transparent;
        }
        
        .canvas-component:hover { box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); }
        .canvas-component.hero-component:hover { box-shadow: none; }
        .canvas-component.selected { border-color: var(--brand); box-shadow: 0 0 0 4px rgba(0, 153, 255, 0.2); }
        .canvas-component.drag-over { border-color: var(--brand); border-style: dashed; }
        
        .component-actions { position: absolute; top: -10px; right: -10px; display: none; gap: 4px; }
        .canvas-component.selected .component-actions { display: flex; }
        
        .action-btn {
            width: 24px; height: 24px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--text-primary);
        }
        
        .action-btn:hover { background: var(--accent-red); border-color: var(--accent-red); color: #fff; }
        
        /* Âè≥‰æßÂ±ûÊÄßÈù¢Êùø */
        .right-panel {
            width: 280px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        [data-theme="light"] .right-panel { box-shadow: -2px 0 8px rgba(0,0,0,0.04); }
        
        .property-header { 
            padding: 12px 14px; 
            border-bottom: 1px solid var(--border); 
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .property-title { font-size: 13px; font-weight: 600; color: var(--text-primary); }
        .property-badge {
            font-size: 10px;
            padding: 2px 8px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            color: var(--text-secondary);
        }
        .property-badge.active {
            background: var(--brand-light);
            color: var(--brand);
        }
        .property-content { flex: 1; overflow-y: auto; padding: 12px; padding-bottom: 0; display: flex; flex-direction: column; }
        .property-content::-webkit-scrollbar { width: 3px; }
        .property-content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
        
        .property-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-muted);
            padding: 40px 20px;
        }
        
        .property-empty-icon { margin-bottom: 16px; opacity: 0.4; }
        .property-empty-text { font-size: 13px; font-weight: 500; margin-bottom: 8px; }
        .property-empty-hint { font-size: 11px; color: #bbb; text-align: center; line-height: 1.5; }
        
        /* Ê≠•È™§ÊåáÂºïÊ†∑Âºè */
        .step-guide {
            background: var(--brand-light);
            border: 1px solid rgba(0, 153, 255, 0.2);
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 12px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .step-guide-icon {
            width: 20px;
            height: 20px;
            background: var(--brand);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 11px;
            font-weight: 600;
            flex-shrink: 0;
        }
        .step-guide-content {
            flex: 1;
        }
        .step-guide-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        .step-guide-desc {
            font-size: 10px;
            color: var(--text-muted);
            line-height: 1.4;
        }
        
        .property-group { margin-bottom: 14px; }
        
        .property-group-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            letter-spacing: 0.3px;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border);
        }
        
        .property-item { margin-bottom: 10px; }
        .property-item:last-child { margin-bottom: 0; }
        .property-label { 
            font-size: 11px; 
            font-weight: 500; 
            color: var(--text-secondary); 
            margin-bottom: 4px; 
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .property-label .tip {
            font-size: 9px;
            color: #bbb;
            font-weight: 400;
        }
        
        .property-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 12px;
            transition: all 0.2s;
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .property-input:focus { outline: none; border-color: var(--brand); box-shadow: 0 0 0 2px rgba(0, 153, 255, 0.15); }
        .property-input::placeholder { color: var(--text-secondary); }
        
        /* Á¥ßÂáëÂûã‰∏ä‰º†Âå∫Âüü */
        .image-upload {
            width: 100%; 
            height: 70px;
            border: 1px dashed var(--border);
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: var(--bg-tertiary);
            transition: all 0.2s;
        }
        
        .image-upload:hover { border-color: var(--brand); background: var(--brand-light); }
        .image-upload-icon { margin-bottom: 4px; color: #bbb; }
        .image-upload-icon svg { width: 20px; height: 20px; }
        .image-upload-text { font-size: 11px; color: var(--text-muted); }
        .image-upload-hint { font-size: 9px; color: #ccc; margin-top: 2px; }
        
        /* ÈÖçËâ≤ÊñπÊ°àÁ¥ßÂáëÂ∏ÉÂ±Ä */
        .color-scheme { display: flex; gap: 6px; margin-bottom: 10px; flex-wrap: wrap; }
        
        .color-preset {
            width: 28px; height: 28px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            transition: all 0.15s ease;
        }
        
        .color-preset:hover { transform: scale(1.08); }
        .color-preset.active { border-color: var(--text-primary); box-shadow: 0 2px 6px rgba(0,0,0,0.15); }
        .color-preset.active::after { content: '‚úì'; position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 11px; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        
        /* Ëá™ÂÆö‰πâÈ¢úËâ≤Á¥ßÂáëÁΩëÊ†º */
        .color-picker-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .color-picker-item { display: flex; flex-direction: column; gap: 3px; }
        .color-picker-label { font-size: 9px; color: var(--text-muted); text-align: center; }
        
        .color-picker-input { width: 100%; height: 24px; border: none; border-radius: 4px; cursor: pointer; padding: 0; }
        .color-picker-input::-webkit-color-swatch-wrapper { padding: 0; }
        .color-picker-input::-webkit-color-swatch { border: 1px solid #E5E5E5; border-radius: 3px; }
        
        .color-hex-input {
            width: 100%;
            padding: 3px 4px;
            border: 1px solid #E5E5E5;
            border-radius: 3px;
            font-size: 9px;
            font-family: monospace;
            text-align: center;
        }
        
        .color-hex-input:focus { outline: none; border-color: var(--brand); }
        
        .color-confirm-btn {
            width: 100%;
            padding: 6px;
            margin-top: 6px;
            border: none;
            border-radius: 4px;
            background: var(--brand);
            color: #fff;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .color-confirm-btn:hover { opacity: 0.85; }
        
        /* Á¥ßÂáëÂûãÊï∞ÈáèÊéßÂà∂ */
        .count-control {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .list-count-btn {
            width: 26px;
            height: 26px;
            border: 1px solid #E5E5E5;
            border-radius: 4px;
            background: #fff;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }
        .list-count-btn:hover { background: var(--bg-tertiary); border-color: var(--brand); }
        .list-count-btn:active { transform: scale(0.95); }
        
        .count-input {
            width: 50px;
            text-align: center;
            padding: 5px;
            border: 1px solid #E5E5E5;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .count-hint {
            font-size: 9px;
            color: #bbb;
            margin-top: 4px;
        }
        
        /* Âà†Èô§ÊåâÈíÆÁ¥ßÂáëÊ†∑Âºè */
        .delete-btn {
            width: 100%;
            padding: 8px;
            border: 1px solid #FFD5D5;
            border-radius: 6px;
            background: #FFF8F8;
            color: var(--accent-red);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            transition: all 0.2s;
        }
        
        .delete-btn:hover { background: var(--accent-red); color: #fff; border-color: var(--accent-red); }
        .delete-btn svg { width: 12px; height: 12px; }
        
        /* Â∏ÉÂ±ÄÈÄâÈ°πÁ¥ßÂáëÊ†∑Âºè */
        .lottery-layout-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }
        .lottery-layout-option {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
            background: var(--bg-tertiary);
        }
        .lottery-layout-option:hover {
            border-color: var(--text-tertiary);
        }
        .lottery-layout-option.selected,
        .lottery-layout-option:has(input:checked) {
            border-color: var(--brand);
            background: var(--brand-light);
        }
        .lottery-layout-option input[type="radio"] {
            margin-right: 6px;
            accent-color: var(--brand);
        }
        .layout-option-text {
            font-size: 11px;
            font-weight: 500;
            color: var(--text-secondary);
        }
        .layout-option-hint {
            font-size: 9px;
            color: var(--text-tertiary);
        }
        
        /* ÊåâÈíÆÊñáÂ≠óÈ¢úËâ≤ÈÄâÊã© */
        .btn-text-color-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .btn-text-color-row label {
            font-size: 11px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .btn-text-color-row input[type="radio"] {
            accent-color: var(--brand);
        }
        
        /* ÊäòÂè†Èù¢ÊùøÊ†∑Âºè */
        .collapsible-section {
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .collapsible-header {
            padding: 8px 10px;
            background: var(--bg-tertiary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            transition: background 0.2s;
        }
        .collapsible-header:hover {
            background: var(--bg);
        }
        .collapsible-header .arrow {
            transition: transform 0.2s;
            font-size: 10px;
            color: var(--text-tertiary);
        }
        .collapsible-section.open .collapsible-header .arrow {
            transform: rotate(180deg);
        }
        .collapsible-content {
            padding: 10px;
            display: none;
        }
        .collapsible-section.open .collapsible-content {
            display: block;
        }
        
        .toast {
            position: fixed;
            top: 80px; left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            border: 1px solid var(--border);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        
        .preview-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 999;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .preview-modal.active { display: flex; }
        
        .preview-modal-close {
            position: absolute;
            top: 20px; right: 20px;
            width: 40px; height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            color: #fff;
            font-size: 20px;
        }
        
        .preview-modal-close:hover { background: rgba(255, 255, 255, 0.2); }
        
        @media (max-height: 950px) { .phone-container { transform: scale(0.85); } }
        @media (max-height: 800px) { .phone-container { transform: scale(0.7); } }
        
        /* ÁªÑ‰ª∂ÂÜÖÊ†∑Âºè */
        .module-card { padding: 16px; }
        .module-card.image-card { padding: 0; background: #fff; border-radius: 12px; overflow: hidden; }
        .module-title { font-size: 17px; font-weight: 600; color: #000; margin-bottom: 16px; }
        
        /* ÂèØÁÇπÂáª‰∏ä‰º†ÁöÑÂõæÁâá */
        .clickable-img { cursor: pointer; transition: all 0.2s; position: relative; }
        .clickable-img-wrapper { position: relative; display: inline-block; }
        .clickable-img-wrapper::after {
            content: 'ÁÇπÂáªÊõøÊç¢';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            color: #fff;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
            border-radius: inherit;
            pointer-events: none;
        }
        .clickable-img-wrapper:hover::after { opacity: 1; }
        
        .coupon-item {
            background: var(--brand-light);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .coupon-item:last-child { margin-bottom: 0; }
        .coupon-left { display: flex; align-items: center; gap: 10px; }
        .coupon-icon { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; }
        .coupon-info .coupon-tag { font-size: 12px; color: rgba(0,0,0,0.9); margin-bottom: 4px; }
        .coupon-info .coupon-name { font-size: 14px; font-weight: 600; color: #000; }
        
        .coupon-btn {
            background: var(--primary-gold);
            border: none;
            border-radius: 16px;
            padding: 8px 14px;
            font-size: 12px;
            font-weight: 500;
            color: #000;
            cursor: pointer;
        }
        
        .lottery-header { margin-bottom: 16px; }
        .lottery-subtitle { font-size: 12px; color: rgba(60, 60, 67, 0.76); display: flex; justify-content: space-between; margin-top: 8px; }
        .lottery-count .num { color: var(--accent-red); font-weight: 600; }
        
        .prize-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px; }
        .prize-card { background: var(--bg-tertiary); border-radius: 12px; padding: 8px; text-align: center; }
        .prize-card img { width: 48px; height: 48px; object-fit: contain; margin-bottom: 4px; }
        .prize-card-title { font-size: 10px; color: rgba(0,0,0,0.9); }
        
        /* ËΩÆÊí≠Â•ñÂìÅÊ†∑Âºè */
        .prize-carousel-container { margin-bottom: 12px; }
        .prize-carousel { scrollbar-width: none; -ms-overflow-style: none; }
        .prize-carousel::-webkit-scrollbar { display: none; }
        .prize-carousel-item { background: var(--bg-tertiary); border-radius: 12px; padding: 8px; text-align: center; }
        .prize-carousel-item img { width: 48px; height: 48px; object-fit: contain; margin-bottom: 4px; }
        
        .lottery-btn {
            width: 100%;
            background: var(--primary-gold);
            border: none;
            border-radius: 14px;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            color: #000;
            cursor: pointer;
        }
        
        .task-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .task-item:last-child { border-bottom: none; }
        .task-info h4 { font-size: 14px; font-weight: 500; color: #000; margin-bottom: 4px; }
        .task-info p { font-size: 10px; color: rgba(60, 60, 67, 0.76); }
        
        .task-btn {
            background: var(--bg-tertiary);
            border: none;
            border-radius: 16px;
            padding: 8px 14px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
        }
        
        .task-btn.primary { background: var(--primary-gold); }
        
        .event-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .event-grid.single-column { grid-template-columns: 1fr; }
        .event-card { border-radius: 12px; overflow: hidden; position: relative; cursor: pointer; }
        .event-card img { width: 100%; height: 80px; object-fit: cover; }
        .event-grid.single-column .event-card img { height: 100px; }
        .event-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 20px 10px 10px; background: linear-gradient(0deg, rgba(62,62,133,0.9), transparent); }
        .event-title { font-size: 14px; font-weight: 600; color: #fff; border-radius: 4px; }
        .event-desc { font-size: 10px; color: rgba(255,255,255,0.9); }
        .event-replace-hint {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            color: #fff;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            z-index: 10;
        }
        .clickable-event-card:hover .event-replace-hint { opacity: 1; }
        
        .progress-container { background: var(--brand-light); border-radius: 12px; padding: 16px 12px; }
        .progress-columns { display: flex; justify-content: space-between; gap: 8px; }
        .progress-column { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .progress-label { font-size: 10px; color: var(--text-tertiary); }
        .progress-label.active { color: var(--text-primary); font-weight: 500; }
        .progress-segment { width: 100%; height: 4px; background: rgba(0,0,0,0.1); border-radius: 2px; overflow: hidden; }
        .progress-segment-fill { height: 100%; width: 0; background: var(--primary-orange); border-radius: 2px; }
        .progress-segment.completed .progress-segment-fill { width: 100%; }
        .reward-tag { font-size: 10px; padding: 4px 10px; border-radius: 10px; background: var(--bg-tertiary); color: var(--text-tertiary); }
        .reward-tag.claimable { background: var(--brand); color: #fff; }
        
        .editable-text { cursor: text; transition: all 0.2s ease; }
        .editable-text:hover { background: var(--brand-light); border-radius: 4px; }
        .editable-text:focus { outline: 2px solid var(--brand); outline-offset: 2px; background: var(--brand-light); }
        
        /* ÂäüËÉΩÂØºÊµÅÁªÑ‰ª∂Ê†∑Âºè */
        .app-download-card {
            background: var(--bg-tertiary);
            border-radius: 16px;
        }
        .app-download-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .app-icon-wrapper {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            overflow: hidden;
            flex-shrink: 0;
            border: 0.5px solid var(--border);
            background: var(--bg-tertiary);
        }
        .app-icon {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .app-info {
            flex: 1;
            min-width: 0;
            overflow: hidden;
        }
        .app-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .app-desc {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .app-download-btn {
            background: var(--primary-orange);
            color: #fff;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            flex-shrink: 0;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .app-download-btn:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="platform-container">
        <div class="toolbar">
            <div class="toolbar-left">
                <div class="logo"><img src="assets/logo.png" alt="Logo"></div>
                <span class="toolbar-title">Êô∫ËÉΩËøêËê•ËÆæËÆ°ÈÖçÁΩÆÂπ≥Âè∞</span>
            </div>
            <div class="toolbar-center">
                <select class="device-select" id="deviceSelect">
                    <option value="375,812">iPhone X/XS/11 Pro (375√ó812)</option>
                    <option value="393,852">iPhone 16/16 Pro (393√ó852)</option>
                    <option value="430,932">iPhone 16 Plus/Pro Max (430√ó932)</option>
                    <option value="424,945">Âçé‰∏∫ Mate 60 Pro (424√ó945)</option>
                    <option value="412,915">Â∞èÁ±≥ 14 Pro (412√ó915)</option>
                    <option value="360,800">OPPO/vivo ‰∏ªÊµÅÊú∫Âûã (360√ó800)</option>
                </select>
            </div>
            <div class="toolbar-right">
                <button class="toolbar-btn" onclick="saveConfig()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    ‰øùÂ≠ò
                </button>
                <button class="toolbar-btn" onclick="previewPage()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                    È¢ÑËßà
                </button>
                <button class="toolbar-btn primary" onclick="exportHTML()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    ÂØºÂá∫HTML
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="panel-header">
                    <div class="panel-title">ÁªÑ‰ª∂Â∫ì</div>
                    <div class="search-box">
                        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                        <input type="text" class="search-input" placeholder="ÊêúÁ¥¢ÁªÑ‰ª∂..." id="componentSearch" oninput="searchComponents(this.value)">
                    </div>
                </div>
                <div class="category-tabs">
                    <button class="category-tab active" data-category="all">ÂÖ®ÈÉ®</button>
                    <button class="category-tab" data-category="lottery">ÊäΩÂ•ñ</button>
                    <button class="category-tab" data-category="coupon">‰ºòÊÉ†Âà∏</button>
                    <button class="category-tab" data-category="task">‰ªªÂä°</button>
                    <button class="category-tab" data-category="event">Ê¥ªÂä®</button>
                    <button class="category-tab" data-category="progress">ËøõÂ∫¶</button>
                </div>
                <div class="component-list">
                    <div class="component-grid" id="componentGrid"></div>
                </div>
            </div>
            
            <div class="center-panel">
                <div class="phone-container" id="phoneContainer">
                    <div class="phone-screen" id="phoneScreen">
                        <div class="canvas-wrapper">
                            <div class="canvas-content" id="canvasContent">
                                <div class="canvas-empty" id="canvasEmpty">
                                    <div class="canvas-empty-icon">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="5" y="2" width="14" height="20" rx="3"/><line x1="12" y1="18" x2="12" y2="18.01" stroke-width="2"/></svg>
                                    </div>
                                    <div class="canvas-empty-text">ÊãñÊãΩÂ∑¶‰æßÁªÑ‰ª∂Âà∞Ê≠§Â§Ñ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="property-header">
                    <span class="property-title">Â±ûÊÄßÈÖçÁΩÆ</span>
                    <span class="property-badge" id="componentBadge">Êú™ÈÄâÊã©</span>
                </div>
                <div class="property-content" id="propertyContent">
                    <div class="property-empty" id="propertyEmpty">
                        <div class="property-empty-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#ddd" stroke-width="1.5">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                <path d="M2 17l10 5 10-5"/>
                                <path d="M2 12l10 5 10-5"/>
                            </svg>
                        </div>
                        <div class="property-empty-text">ÈÄâÊã©ÁªÑ‰ª∂ÂºÄÂßãÁºñËæë</div>
                        <div class="property-empty-hint">‰ªéÂ∑¶‰æßÊãñÊãΩÁªÑ‰ª∂Âà∞ÁîªÂ∏É<br>ÊàñÁÇπÂáªÁîªÂ∏É‰∏≠ÁöÑÁªÑ‰ª∂ËøõË°åÁºñËæë</div>
                    </div>
                    
                    <div id="propertyEditor" style="display: none;">
                        <!-- Ê≠•È™§ÊåáÂºï -->
                        <div class="step-guide" id="stepGuide">
                            <div class="step-guide-icon">1</div>
                            <div class="step-guide-content">
                                <div class="step-guide-title" id="stepGuideTitle">ÁºñËæëÁªÑ‰ª∂ÂÜÖÂÆπ</div>
                                <div class="step-guide-desc" id="stepGuideDesc">‰øÆÊîπ‰∏ãÊñπÊñáÊ°àÂíåÈÖçÁΩÆÔºåÂÆûÊó∂È¢ÑËßàÊïàÊûú</div>
                            </div>
                        </div>
                        
                        <!-- ‰∏ªËßÜËßâ‰∏ìÁî®ÁºñËæëÂå∫ -->
                        <div class="property-group" id="heroEditorGroup" style="display: none;">
                            <div class="property-group-title">üì∑ Â™í‰Ωì‰∏ä‰º†</div>
                            <div class="property-item">
                                <div class="image-upload hero-upload" onclick="document.getElementById('heroMediaInput').click()">
                                    <div class="image-upload-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                    </div>
                                    <div class="image-upload-text">ÁÇπÂáª‰∏ä‰º†ËßÜÈ¢ëÊàñÂõæÁâá</div>
                                    <div class="image-upload-hint">ÊîØÊåÅ MP4/PNG/JPGÔºåÂª∫ËÆÆ1:1</div>
                                </div>
                                <input type="file" id="heroMediaInput" accept="video/mp4,image/png,image/jpeg,image/jpg" style="display: none;" onchange="handleHeroMediaUpload(event)">
                            </div>
                            <div class="property-item" id="heroMediaPreview" style="display:none;">
                                <label class="property-label">Â∑≤‰∏ä‰º†</label>
                                <div id="heroPreviewContainer" style="width:100%;border-radius:6px;overflow:hidden;background:#f5f5f5;max-height:120px;"></div>
                                <button class="delete-btn" style="margin-top:6px;" onclick="clearHeroMedia()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                    Ê∏ÖÈô§Â™í‰Ωì
                                </button>
                            </div>
                        </div>
                        
                        <!-- Á∫ØÂõæÁâáÁºñËæëÂå∫ -->
                        <div class="property-group" id="imageEditorGroup" style="display: none;">
                            <div class="property-group-title">üì∑ ÂõæÁâá‰∏ä‰º†</div>
                            <div class="property-item">
                                <div class="image-upload" onclick="document.getElementById('pureImageInput').click()">
                                    <div class="image-upload-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
                                    </div>
                                    <div class="image-upload-text">ÁÇπÂáª‰∏ä‰º†ÂõæÁâá</div>
                                    <div class="image-upload-hint">ÊîØÊåÅ PNG/JPG Ê†ºÂºè</div>
                                </div>
                                <input type="file" id="pureImageInput" accept="image/png,image/jpeg,image/jpg" style="display: none;" onchange="handlePureImageUpload(event)">
                            </div>
                            <div class="property-item" id="imagePreviewSection" style="display:none;">
                                <label class="property-label">Â∑≤‰∏ä‰º†</label>
                                <div id="imagePreviewContainer" style="width:100%;border-radius:6px;overflow:hidden;background:#f5f5f5;max-height:100px;"></div>
                                <button class="delete-btn" style="margin-top:6px;" onclick="clearPureImage()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                    Ê∏ÖÈô§ÂõæÁâá
                                </button>
                            </div>
                        </div>
                        
                        <!-- ÂäüËÉΩÂØºÊµÅ‰∏ìÂ±ûÁºñËæëÂå∫ -->
                        <div class="property-group" id="appDownloadEditorGroup" style="display: none;">
                            <div class="property-group-title">üì± Â∫îÁî®‰ø°ÊÅØ</div>
                            <div class="property-item">
                                <label class="property-label">Â∫îÁî®ÂõæÊ†á</label>
                                <div class="image-upload" style="height:60px;" onclick="document.getElementById('appIconInput').click()">
                                    <div class="image-upload-icon">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
                                    </div>
                                    <div class="image-upload-text">‰∏ä‰º†Â∫îÁî®ÂõæÊ†á</div>
                                    <div class="image-upload-hint">Âª∫ËÆÆ48√ó48Ê≠£ÊñπÂΩ¢</div>
                                </div>
                                <input type="file" id="appIconInput" accept="image/png,image/jpeg,image/jpg" style="display: none;" onchange="handleAppIconUpload(event)">
                            </div>
                            <div class="property-item">
                                <label class="property-label">Â∫îÁî®ÂêçÁß∞ <span class="tip">ÂøÖÂ°´</span></label>
                                <input type="text" class="property-input" id="propAppName" placeholder="Â¶ÇÔºöËÖæËÆØËßÜÈ¢ë" oninput="updateProp('appName', this.value)">
                            </div>
                            <div class="property-item">
                                <label class="property-label">Â∫îÁî®ÊèèËø∞ <span class="tip">ÈÄâÂ°´</span></label>
                                <input type="text" class="property-input" id="propAppDesc" placeholder="Â¶ÇÔºöÊµ∑ÈáèÈ´òÊ∏ÖËßÜÈ¢ëÂú®Á∫øËßÇÁúã" oninput="updateProp('appDesc', this.value)">
                            </div>
                            <div class="property-item">
                                <label class="property-label">ÊåâÈíÆÊñáÂ≠ó</label>
                                <input type="text" class="property-input" id="propAppButtonText" placeholder="Â¶ÇÔºöÁ´ãÂç≥‰∏ãËΩΩ" oninput="updateProp('buttonText', this.value)">
                            </div>
                        </div>
                        
                        <!-- ÈÄöÁî®ÊñáÊ°àÁºñËæëÂå∫ -->
                        <div class="property-group" id="textEditorGroup">
                            <div class="property-group-title">‚úèÔ∏è ÊñáÊ°àÁºñËæë</div>
                            <div class="property-item">
                                <label class="property-label">Ê†áÈ¢ò <span class="tip">ÂøÖÂ°´</span></label>
                                <input type="text" class="property-input" id="propTitle" placeholder="Â¶ÇÔºöÊñ∞Âπ¥Á¶èÂà©Â§ßÊîæÈÄÅ" oninput="updateProp('title', this.value)">
                            </div>
                            <div class="property-item">
                                <label class="property-label">ÂâØÊ†áÈ¢ò <span class="tip">ÈÄâÂ°´</span></label>
                                <input type="text" class="property-input" id="propSubtitle" placeholder="Â¶ÇÔºöÈôêÊó∂‰ºòÊÉ†ÔºåÂÖàÂà∞ÂÖàÂæó" oninput="updateProp('subtitle', this.value)">
                            </div>
                            <div class="property-item" id="buttonTextItem">
                                <label class="property-label">ÊåâÈíÆÊñáÂ≠ó</label>
                                <input type="text" class="property-input" id="propButtonText" placeholder="Â¶ÇÔºöÁ´ãÂç≥È¢ÜÂèñ" oninput="updateProp('buttonText', this.value)">
                            </div>
                        </div>
                        
                        <!-- ÂàóË°®Êï∞ÈáèÈÖçÁΩÆÂå∫ -->
                        <div class="property-group" id="listCountGroup" style="display:none;">
                            <div class="property-group-title">üìã ÂàóË°®ÈÖçÁΩÆ</div>
                            <div class="property-item">
                                <label class="property-label">ÊòæÁ§∫Êï∞Èáè</label>
                                <div class="count-control">
                                    <button class="list-count-btn" onclick="adjustListCount(-1)">‚àí</button>
                                    <input type="number" class="count-input" id="propListCount" value="2" min="1" max="6" onchange="setListCount(parseInt(this.value))">
                                    <button class="list-count-btn" onclick="adjustListCount(1)">+</button>
                                </div>
                                <div class="count-hint" id="listCountHint">ÂΩìÂâç2È°πÔºåÊúÄÂ§ö6È°π</div>
                            </div>
                        </div>
                        
                        <!-- ËøõÂ∫¶Êù°Èò∂ÊÆµÈÖçÁΩÆÂå∫ -->
                        <div class="property-group" id="progressStageGroup" style="display:none;">
                            <div class="property-group-title">üìä Èò∂ÊÆµÈÖçÁΩÆ</div>
                            <div class="property-item">
                                <label class="property-label">Èò∂ÊÆµÊï∞Èáè</label>
                                <div class="count-control">
                                    <button class="list-count-btn" onclick="adjustProgressStages(-1)">‚àí</button>
                                    <input type="number" class="count-input" id="propStageCount" value="3" min="2" max="5" onchange="setProgressStages(parseInt(this.value))">
                                    <button class="list-count-btn" onclick="adjustProgressStages(1)">+</button>
                                </div>
                                <div class="count-hint" id="stageCountHint">ÂΩìÂâç3Èò∂ÊÆµÔºå2-5ÂèØÈÄâ</div>
                            </div>
                        </div>
                        
                        <!-- ÊäΩÂ•ñÂ∏ÉÂ±ÄÈÖçÁΩÆÂå∫ -->
                        <div class="property-group" id="lotteryLayoutGroup" style="display:none;">
                            <div class="property-group-title">üé∞ Â•ñÂìÅÂ∏ÉÂ±Ä</div>
                            <div class="property-item">
                                <div class="lottery-layout-options">
                                    <label class="lottery-layout-option">
                                        <input type="radio" name="lotteryLayout" value="3" onchange="setLotteryLayout(3)">
                                        <div>
                                            <div class="layout-option-text">3‰∏™</div>
                                            <div class="layout-option-hint">‰∏ÄÊéí</div>
                                        </div>
                                    </label>
                                    <label class="lottery-layout-option">
                                        <input type="radio" name="lotteryLayout" value="6" checked onchange="setLotteryLayout(6)">
                                        <div>
                                            <div class="layout-option-text">6‰∏™</div>
                                            <div class="layout-option-hint">‰∏§Êéí</div>
                                        </div>
                                    </label>
                                    <label class="lottery-layout-option">
                                        <input type="radio" name="lotteryLayout" value="9" onchange="setLotteryLayout(9)">
                                        <div>
                                            <div class="layout-option-text">9‰∏™</div>
                                            <div class="layout-option-hint">‰∏âÊéí</div>
                                        </div>
                                    </label>
                                    <label class="lottery-layout-option">
                                        <input type="radio" name="lotteryLayout" value="carousel" onchange="setLotteryLayout('carousel')">
                                        <div>
                                            <div class="layout-option-text">ËΩÆÊí≠</div>
                                            <div class="layout-option-hint">9+‰∏™</div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div class="property-item" id="lotteryCarouselCountGroup" style="display:none;">
                                <label class="property-label">ËΩÆÊí≠Êï∞Èáè</label>
                                <div class="count-control">
                                    <button class="list-count-btn" onclick="adjustLotteryCarouselCount(-1)">‚àí</button>
                                    <input type="number" class="count-input" id="propLotteryCarouselCount" value="12" min="10" max="20" onchange="setLotteryCarouselCount(parseInt(this.value))">
                                    <button class="list-count-btn" onclick="adjustLotteryCarouselCount(1)">+</button>
                                </div>
                                <div class="count-hint" id="lotteryCarouselHint">ÂΩìÂâç12‰∏™Ôºå10-20ÂèØÈÄâ</div>
                            </div>
                        </div>
                        
                        <!-- ÈÖçËâ≤ÊñπÊ°à - ÊäòÂè†Èù¢Êùø -->
                        <div class="collapsible-section open" id="colorSection">
                            <div class="collapsible-header" onclick="toggleCollapsible('colorSection')">
                                <span>üé® ÈÖçËâ≤ÊñπÊ°à</span>
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="collapsible-content">
                                <div class="color-scheme" id="colorScheme">
                                    <div class="color-preset active" style="background: #FEDF9C;" data-scheme="gold" onclick="applyColorScheme('gold')" title="ÈáëËâ≤"></div>
                                    <div class="color-preset" style="background: #667eea;" data-scheme="purple" onclick="applyColorScheme('purple')" title="Á¥´Ëâ≤"></div>
                                    <div class="color-preset" style="background: #11998e;" data-scheme="green" onclick="applyColorScheme('green')" title="ÁªøËâ≤"></div>
                                    <div class="color-preset" style="background: #ee0979;" data-scheme="red" onclick="applyColorScheme('red')" title="Á∫¢Ëâ≤"></div>
                                    <div class="color-preset" style="background: #0099ff;" data-scheme="blue" onclick="applyColorScheme('blue')" title="ËìùËâ≤"></div>
                                    <div class="color-preset" style="background: #F68910;" data-scheme="orange" onclick="applyColorScheme('orange')" title="Ê©ôËâ≤"></div>
                                </div>
                                
                                <div class="property-item">
                                    <label class="property-label">ÊåâÈíÆÊñáÂ≠ó</label>
                                    <div class="btn-text-color-row">
                                        <label>
                                            <input type="radio" name="btnTextColor" value="#000000" checked onchange="updateButtonTextColor(this.value)"> ÈªëËâ≤
                                        </label>
                                        <label>
                                            <input type="radio" name="btnTextColor" value="#ffffff" onchange="updateButtonTextColor(this.value)"> ÁôΩËâ≤
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ëá™ÂÆö‰πâÈ¢úËâ≤ - ÊäòÂè†Èù¢Êùø -->
                        <div class="collapsible-section" id="customColorSection">
                            <div class="collapsible-header" onclick="toggleCollapsible('customColorSection')">
                                <span>üîß Ëá™ÂÆö‰πâÈ¢úËâ≤</span>
                                <span class="arrow">‚ñº</span>
                            </div>
                            <div class="collapsible-content">
                                <div class="color-picker-grid">
                                    <div class="color-picker-item">
                                        <span class="color-picker-label">ÊåâÈíÆËâ≤</span>
                                        <input type="color" class="color-picker-input" id="primaryColor" value="#FEDF9C" oninput="updateCustomColor('primary', this.value)">
                                        <input type="text" class="color-hex-input" id="primaryHex" value="#FEDF9C" onchange="updateColorFromHex('primary', this.value)">
                                    </div>
                                    <div class="color-picker-item">
                                        <span class="color-picker-label">Âº∫Ë∞ÉËâ≤</span>
                                        <input type="color" class="color-picker-input" id="accentColor" value="#F68910" oninput="updateCustomColor('accent', this.value)">
                                        <input type="text" class="color-hex-input" id="accentHex" value="#F68910" onchange="updateColorFromHex('accent', this.value)">
                                    </div>
                                    <div class="color-picker-item">
                                        <span class="color-picker-label">ËÉåÊôØËâ≤</span>
                                        <input type="color" class="color-picker-input" id="bgColor" value="#FFE23A" oninput="updateCustomColor('background', this.value)">
                                        <input type="text" class="color-hex-input" id="bgHex" value="#FFE23A" onchange="updateColorFromHex('background', this.value)">
                                    </div>
                                </div>
                                <button class="color-confirm-btn" onclick="applyCustomColors()">Â∫îÁî®ÈÖçËâ≤</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Âà†Èô§ÊåâÈíÆÂõ∫ÂÆöÂú®Â∫ïÈÉ® -->
                    <div id="deleteButtonWrapper" style="display:none;padding:12px;border-top:1px solid #f0f0f0;margin-top:auto;">
                        <button class="delete-btn" onclick="deleteSelectedComponent()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                            Âà†Èô§Ê≠§ÁªÑ‰ª∂
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <div class="preview-modal" id="previewModal">
        <button class="preview-modal-close" onclick="closePreview()">‚úï</button>
        <div class="phone-container">
            <div class="phone-screen" id="previewScreen">
                <div class="canvas-wrapper">
                    <div class="canvas-content" id="previewContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÁªÑ‰ª∂Á±ªÂûãÂÆö‰πâÔºàÂê´Áº©Áï•ÂõæÔºâ
        const componentTypes = [
            { type: 'hero', name: '‰∏ªËßÜËßâ', category: 'event' },
            { type: 'coupon', name: '‰ºòÊÉ†Âà∏', category: 'coupon' },
            { type: 'lottery', name: 'ÊäΩÂ•ñ', category: 'lottery' },
            { type: 'task', name: '‰ªªÂä°ÂàóË°®', category: 'task' },
            { type: 'event', name: 'ÂõæÊñábanner', category: 'event' },
            { type: 'progress', name: 'ÈÇÄËØ∑Âä©Âäõ', category: 'progress' },
            { type: 'image', name: 'Á∫ØÂõæÁâá', category: 'event' },
            { type: 'appDownload', name: 'ÂäüËÉΩÂØºÊµÅ', category: 'event' },
        ];
        
        // Ëé∑ÂèñÁªÑ‰ª∂Áº©Áï•ÂõæHTML
        function getComponentThumbnail(type) {
            const thumbs = {
                hero: `<div style="width:100%;height:100%;background:#FEDF9C;display:flex;align-items:center;justify-content:center;border-radius:6px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.5"><rect x="2" y="2" width="20" height="20" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
                </div>`,
                coupon: `<div style="width:100%;height:100%;background:#FFF8E3;border-radius:6px;padding:6px;display:flex;flex-direction:column;gap:4px;">
                    <div style="flex:1;background:#FEDF9C;border-radius:4px;display:flex;align-items:center;padding:0 6px;">
                        <div style="width:12px;height:12px;background:#F68910;border-radius:2px;margin-right:4px;"></div>
                        <div style="flex:1;height:4px;background:rgba(0,0,0,0.1);border-radius:2px;"></div>
                        <div style="width:20px;height:10px;background:#F68910;border-radius:8px;margin-left:4px;"></div>
                    </div>
                    <div style="flex:1;background:#FEDF9C;border-radius:4px;display:flex;align-items:center;padding:0 6px;">
                        <div style="width:12px;height:12px;background:#F68910;border-radius:2px;margin-right:4px;"></div>
                        <div style="flex:1;height:4px;background:rgba(0,0,0,0.1);border-radius:2px;"></div>
                        <div style="width:20px;height:10px;background:#F68910;border-radius:8px;margin-left:4px;"></div>
                    </div>
                </div>`,
                lottery: `<div style="width:100%;height:100%;background:#FFF8E3;border-radius:6px;padding:6px;display:flex;flex-direction:column;gap:4px;">
                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:3px;flex:1;">
                        <div style="background:#f5f5f5;border-radius:3px;"></div>
                        <div style="background:#f5f5f5;border-radius:3px;"></div>
                        <div style="background:#f5f5f5;border-radius:3px;"></div>
                        <div style="background:#f5f5f5;border-radius:3px;"></div>
                        <div style="background:#f5f5f5;border-radius:3px;"></div>
                        <div style="background:#f5f5f5;border-radius:3px;"></div>
                    </div>
                    <div style="height:12px;background:#FEDF9C;border-radius:4px;"></div>
                </div>`,
                task: `<div style="width:100%;height:100%;background:#fff;border-radius:6px;padding:6px;display:flex;flex-direction:column;gap:4px;">
                    <div style="display:flex;align-items:center;gap:4px;">
                        <div style="flex:1;height:4px;background:#ddd;border-radius:2px;"></div>
                        <div style="width:20px;height:10px;background:#FEDF9C;border-radius:8px;"></div>
                    </div>
                    <div style="display:flex;align-items:center;gap:4px;">
                        <div style="flex:1;height:4px;background:#ddd;border-radius:2px;"></div>
                        <div style="width:20px;height:10px;background:#f0f0f0;border-radius:8px;"></div>
                    </div>
                    <div style="display:flex;align-items:center;gap:4px;">
                        <div style="flex:1;height:4px;background:#ddd;border-radius:2px;"></div>
                        <div style="width:20px;height:10px;background:#f0f0f0;border-radius:8px;"></div>
                    </div>
                </div>`,
                event: `<div style="width:100%;height:100%;background:#FFF8E3;border-radius:6px;padding:4px;display:grid;grid-template-columns:1fr 1fr;gap:4px;">
                    <div style="background:#f5f5f5;border-radius:4px;position:relative;overflow:hidden;">
                        <div style="position:absolute;bottom:0;left:0;right:0;height:40%;background:#FEDF9C;"></div>
                    </div>
                    <div style="background:#f5f5f5;border-radius:4px;position:relative;overflow:hidden;">
                        <div style="position:absolute;bottom:0;left:0;right:0;height:40%;background:#F68910;"></div>
                    </div>
                </div>`,
                progress: `<div style="width:100%;height:100%;background:#FFF8E3;border-radius:6px;padding:8px 6px;display:flex;flex-direction:column;justify-content:center;gap:6px;">
                    <div style="display:flex;gap:4px;">
                        <div style="flex:1;height:4px;background:#F68910;border-radius:2px;"></div>
                        <div style="flex:1;height:4px;background:rgba(0,0,0,0.1);border-radius:2px;"></div>
                        <div style="flex:1;height:4px;background:rgba(0,0,0,0.1);border-radius:2px;"></div>
                    </div>
                    <div style="display:flex;justify-content:space-between;">
                        <div style="width:16px;height:8px;background:#F68910;border-radius:4px;"></div>
                        <div style="width:16px;height:8px;background:rgba(0,0,0,0.1);border-radius:4px;"></div>
                        <div style="width:16px;height:8px;background:rgba(0,0,0,0.1);border-radius:4px;"></div>
                    </div>
                </div>`,
                image: `<div style="width:100%;height:100%;background:#fff;border-radius:6px;display:flex;align-items:center;justify-content:center;border:1px dashed #ddd;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
                </div>`,
                appDownload: `<div style="width:100%;height:100%;background:#fff;border-radius:6px;padding:8px;display:flex;align-items:center;gap:6px;box-sizing:border-box;">
                    <div style="width:28px;height:28px;background:#FEDF9C;border-radius:6px;flex-shrink:0;"></div>
                    <div style="flex:1;min-width:0;display:flex;flex-direction:column;gap:4px;">
                        <div style="height:6px;background:#333;border-radius:3px;width:70%;"></div>
                        <div style="height:4px;background:#ddd;border-radius:2px;width:90%;"></div>
                    </div>
                    <div style="width:28px;height:16px;background:#F68910;border-radius:8px;flex-shrink:0;"></div>
                </div>`
            };
            return thumbs[type] || '<div style="width:100%;height:100%;background:#f5f5f5;border-radius:6px;"></div>';
        }
        
        // ÈÖçËâ≤ÊñπÊ°àÔºàÂ¢ûÂä†ÊñáÂ≠óÈ¢úËâ≤Ôºâ
        const colorSchemes = {
            gold: { primary: '#FEDF9C', accent: '#F68910', background: '#FFE23A', btnBg: '#FFF8E3', textColor: '#000000' },
            purple: { primary: '#667eea', accent: '#764ba2', background: '#EEE5FF', btnBg: '#F5F0FF', textColor: '#ffffff' },
            green: { primary: '#11998e', accent: '#055751', background: '#E0FFF5', btnBg: '#F0FFF8', textColor: '#ffffff' },
            red: { primary: '#ee0979', accent: '#85002e', background: '#FFE5E5', btnBg: '#FFF5F0', textColor: '#ffffff' },
            blue: { primary: '#0099ff', accent: '#0066cc', background: '#E5F5FF', btnBg: '#F0FAFF', textColor: '#ffffff' },
            orange: { primary: '#F68910', accent: '#8f4c00', background: '#FFF3E0', btnBg: '#FFF8F0', textColor: '#ffffff' }
        };
        
        // Áä∂ÊÄÅÁÆ°ÁêÜ
        let canvasComponents = [];
        let selectedComponentId = null;
        let currentColorScheme = 'gold';
        let customColors = { ...colorSchemes.gold, textColor: '#000000' };
        let componentIdCounter = 0;
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initComponentGrid();
            initCategoryTabs();
            initDragAndDrop();
            initDeviceSelect();
            loadFromLocalStorage();
        });
        
        // ÂàùÂßãÂåñÁªÑ‰ª∂ÁΩëÊ†º
        function initComponentGrid() {
            const grid = document.getElementById('componentGrid');
            grid.innerHTML = componentTypes.map(comp => `
                <div class="component-card" draggable="true" data-type="${comp.type}" data-category="${comp.category}">
                    <div class="component-thumb">${getComponentThumbnail(comp.type)}</div>
                    <div class="component-name">${comp.name}</div>
                </div>
            `).join('');
            
            // ‰∏∫ÁªÑ‰ª∂Âç°ÁâáÁªëÂÆöÊãñÊãΩÂíåÁÇπÂáª‰∫ã‰ª∂
            grid.querySelectorAll('.component-card').forEach(card => {
                // ÊãñÊãΩ‰∫ã‰ª∂
                card.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('componentType', this.dataset.type);
                    e.dataTransfer.setData('isNew', 'true');
                    this.classList.add('dragging');
                });
                card.addEventListener('dragend', function() { 
                    this.classList.remove('dragging'); 
                });
                // ÁÇπÂáªÊ∑ªÂä†ÁªÑ‰ª∂
                card.addEventListener('click', function() {
                    addComponentToCanvas(this.dataset.type);
                });
            });
        }
        
        // ÂàùÂßãÂåñÂàÜÁ±ªÊ†áÁ≠æ
        function initCategoryTabs() {
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    filterComponents(this.dataset.category);
                });
            });
        }
        
        // ËøáÊª§ÁªÑ‰ª∂
        function filterComponents(category) {
            document.querySelectorAll('.component-card').forEach(card => {
                card.style.display = (category === 'all' || card.dataset.category === category) ? 'block' : 'none';
            });
        }
        
        // ÊêúÁ¥¢ÁªÑ‰ª∂
        function searchComponents(keyword) {
            const kw = keyword.toLowerCase();
            document.querySelectorAll('.component-card').forEach(card => {
                const name = card.querySelector('.component-name').textContent.toLowerCase();
                card.style.display = name.includes(kw) ? 'block' : 'none';
            });
        }
        
        // ÂàùÂßãÂåñÊãñÊãΩÔºàÁîªÂ∏ÉÂå∫ÂüüÔºâ
        function initDragAndDrop() {
            const canvas = document.getElementById('canvasContent');
            
            canvas.addEventListener('dragover', function(e) { e.preventDefault(); });
            canvas.addEventListener('drop', function(e) {
                e.preventDefault();
                if (e.dataTransfer.getData('isNew') === 'true') {
                    addComponentToCanvas(e.dataTransfer.getData('componentType'));
                }
            });
        }
        
        // ÂàùÂßãÂåñËÆæÂ§áÈÄâÊã©
        function initDeviceSelect() {
            document.getElementById('deviceSelect').addEventListener('change', function() {
                const [w, h] = this.value.split(',').map(Number);
                const screen = document.getElementById('phoneScreen');
                screen.style.width = w + 'px';
                screen.style.height = h + 'px';
            });
        }
        
        // Ê∑ªÂä†ÁªÑ‰ª∂Âà∞ÁîªÂ∏É
        function addComponentToCanvas(type) {
            const id = 'comp_' + (++componentIdCounter);
            canvasComponents.push({ id, type, props: getDefaultProps(type) });
            renderCanvas();
            selectComponent(id);
            showToast('Â∑≤Ê∑ªÂä†');
        }
        
        // Ëé∑ÂèñÈªòËÆ§Â±ûÊÄß
        function getDefaultProps(type) {
            const defaults = {
                hero: { title: '‰∏ªËßÜËßâ', mediaType: 'image', mediaUrl: '', aspectRatio: '1:1' },
                coupon: { title: 'Á¨¨‰∏ÄÂºπ„ÄåÁ•ûÂà∏„Äç', items: [{ name: 'Êª°38-16‰ºòÊÉ†Âà∏', tag: '‰∏ìÂ±ûÁ§º' }, { name: 'Êª°100-5‰ºòÊÉ†Âà∏', tag: '‰∏ìÂ±ûÁ§º' }], buttonText: 'ÂºÄÂøÉÊî∂‰∏ã' },
                lottery: { title: 'Á¨¨‰∫åÂºπ„Äå9ÊäΩËµ¢Â§ßÂ•ñ„Äç', subtitle: 'Ââ©‰ΩôÊäΩÂ•ñÊ¨°Êï∞Ôºö9/11', buttonText: 'Á´ãÂç≥ÊäΩÂ•ñ', layout: 6, prizes: [] },
                task: { title: 'ÂÅö‰ªªÂä°È¢ÜÊäΩÂ•ñÊú∫‰ºö', tasks: [{ name: 'È¢ÜSVIP‰∏ì‰∫´Êú∫‰ºö', desc: 'SVIPÁî®Êà∑ÂèØÈ¢ùÂ§ñËé∑Âæó1Ê¨°ÊäΩÂ•ñÊú∫‰ºö', btn: 'È¢ÜÂèñ' }, { name: 'ËÆ¢ÈòÖÁ¶èÂà©Á§æÈÄöÁü•', desc: 'ÂÆåÊàêËÆ¢ÈòÖËé∑Âæó1Ê¨°ÊäΩÂ•ñÊú∫‰ºö', btn: 'ÂâçÂæÄ' }] },
                event: { title: '2ÊúàÂ§ß‰∫ã‰ª∂', events: [{ title: 'SVIPÂêØËà™2026', desc: '60ÊäΩÂøÖÂæó12‰∏™ÊúàSVIP' }, { title: 'SVIP√óÁéãËÄÖËç£ËÄÄ', desc: 'ÂºÄÈÄöÂæóÁ®ÄÊúâÂè≤ËØóÁöÆËÇ§' }] },
                progress: { title: 'ÈÇÄÂ•ΩÂèãÂä©Âäõ', subtitle: 'Á¥ØËÆ°Ëé∑Âæó15Âä©ÂäõÂÄºÂèØËß£ÈîÅÊúÄÈ´ò4Ê¨°Êú∫‰ºö', milestones: ['1‰∫∫', '5‰∫∫', '10‰∫∫'], current: 1 },
                image: { title: 'Á∫ØÂõæÁâá', imageUrl: '' },
                appDownload: { title: '', appName: 'ËÖæËÆØËßÜÈ¢ë', appDesc: 'Êµ∑ÈáèÈ´òÊ∏ÖËßÜÈ¢ëÂú®Á∫øËßÇÁúã', buttonText: 'Á´ãÂç≥‰∏ãËΩΩ', iconUrl: '' }
            };
            return defaults[type] || { title: 'ÁªÑ‰ª∂' };
        }
        
        // Ê∏≤ÊüìÁîªÂ∏É
        function renderCanvas() {
            const canvas = document.getElementById('canvasContent');
            const empty = document.getElementById('canvasEmpty');
            
            empty.style.display = canvasComponents.length === 0 ? 'block' : 'none';
            canvas.querySelectorAll('.canvas-component').forEach(el => el.remove());
            
            canvasComponents.forEach(comp => {
                const el = document.createElement('div');
                const isHero = comp.type === 'hero';
                el.className = 'canvas-component' + (isHero ? ' hero-component' : '') + (comp.id === selectedComponentId ? ' selected' : '');
                el.id = comp.id;
                el.draggable = true;
                el.innerHTML = renderComponentHTML(comp) + `<div class="component-actions"><button class="action-btn" onclick="event.stopPropagation();deleteComponent('${comp.id}')" title="Âà†Èô§">‚úï</button></div>`;
                
                el.addEventListener('click', () => selectComponent(comp.id));
                el.addEventListener('dragstart', e => { e.dataTransfer.setData('componentId', comp.id); e.dataTransfer.setData('isNew', 'false'); el.classList.add('dragging'); });
                el.addEventListener('dragend', () => el.classList.remove('dragging'));
                el.addEventListener('dragover', e => { e.preventDefault(); el.classList.add('drag-over'); });
                el.addEventListener('dragleave', () => el.classList.remove('drag-over'));
                el.addEventListener('drop', e => {
                    e.preventDefault(); e.stopPropagation(); el.classList.remove('drag-over');
                    const draggedId = e.dataTransfer.getData('componentId');
                    if (e.dataTransfer.getData('isNew') === 'false' && draggedId && draggedId !== comp.id) reorderComponents(draggedId, comp.id);
                });
                
                canvas.appendChild(el);
            });
            
            applyColorsToCanvas();
        }
        
        // Ê∏≤ÊüìÁªÑ‰ª∂HTML
        // Ê≥®ÊÑèÔºöÊ®°ÂùóÊ†áÈ¢òÂßãÁªà‰∏∫ÈªëËâ≤ÔºåÂè™Êúâ‰∏ªËâ≤ËÉåÊôØ‰∏äÁöÑÊñáÊú¨‰ΩøÁî®textColor
        function renderComponentHTML(comp) {
            const txtColor = customColors.textColor || '#000';
            const titleColor = '#000'; // Ê®°ÂùóÊ†áÈ¢òÂõ∫ÂÆöÈªëËâ≤
            switch(comp.type) {
                case 'hero':
                    const heroStyle = 'width:100%;aspect-ratio:1/1;display:block;object-fit:cover;';
                    if (comp.props.mediaUrl) {
                        if (comp.props.mediaType === 'video') {
                            return `<div class="hero-module" style="margin:0;border-radius:0;overflow:hidden;"><video src="${comp.props.mediaUrl}" style="${heroStyle}" autoplay loop muted playsinline></video></div>`;
                        } else {
                            return `<div class="hero-module" style="margin:0;border-radius:0;overflow:hidden;"><img src="${comp.props.mediaUrl}" style="${heroStyle}"></div>`;
                        }
                    } else {
                        return `<div class="hero-module hero-placeholder" style="width:100%;aspect-ratio:1/1;background:${customColors.primary};display:flex;flex-direction:column;align-items:center;justify-content:center;color:${txtColor};"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="2" width="20" height="20" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg><div style="font-size:14px;font-weight:500;margin-top:12px;">‰∏ªËßÜËßâÂå∫Âüü</div><div style="font-size:12px;opacity:0.8;margin-top:4px;">‰∏ä‰º†ËßÜÈ¢ëÊàñÂõæÁâá</div></div>`;
                    }
                case 'coupon':
                    return `<div class="module-card"><div class="module-title editable-text" contenteditable="true" style="color:${titleColor}">${comp.props.title}</div><div>${comp.props.items.map((item, idx) => `<div class="coupon-item"><div class="coupon-left"><span class="clickable-img-wrapper" style="border-radius:8px;"><img class="coupon-icon clickable-img" src="${item.icon || 'assets/CodeBubbyAssets/45_550/33.png'}" data-comp-id="${comp.id}" data-item-idx="${idx}" data-img-type="coupon" onclick="triggerItemImageUpload(this)" onerror="this.src='https://placehold.co/40x40/FFF8E3/F68910?text=C'"></span><div class="coupon-info"><div class="coupon-tag editable-text" contenteditable="true">${item.tag}</div><div class="coupon-name editable-text" contenteditable="true">${item.name}</div></div></div><button class="coupon-btn" style="color:${txtColor}">${comp.props.buttonText}</button></div>`).join('')}</div></div>`;
                case 'lottery':
                    const layout = comp.props.layout || 6;
                    const isCarousel = layout === 'carousel' || layout > 9;
                    let prizeCount = isCarousel ? (comp.props.prizes && comp.props.prizes.length > 9 ? comp.props.prizes.length : 12) : layout;
                    
                    // Á°Æ‰øùprizesÊï∞ÁªÑÊúâË∂≥Â§üÁöÑÂÖÉÁ¥†
                    if (!comp.props.prizes) comp.props.prizes = [];
                    while (comp.props.prizes.length < prizeCount) {
                        comp.props.prizes.push('');
                    }
                    
                    let prizeGridHtml = '';
                    if (isCarousel) {
                        // ËΩÆÊí≠Ê®°ÂºèÔºö‰∏ÄÊéíÊ®™ÂêëÊªöÂä®
                        prizeGridHtml = `<div class="prize-carousel-container" style="overflow:hidden;position:relative;">
                            <div class="prize-carousel" style="display:flex;gap:8px;overflow-x:auto;padding:8px 0;scroll-behavior:smooth;">
                                ${Array.from({length: prizeCount}, (_, i) => `<div class="prize-card prize-carousel-item" style="flex:0 0 72px;min-width:72px;">
                                    <span class="clickable-img-wrapper" style="border-radius:8px;"><img class="clickable-img" src="${comp.props.prizes[i] || 'assets/CodeBubbyAssets/45_550/'+(39+(i%6))+'.png'}" data-comp-id="${comp.id}" data-item-idx="${i}" data-img-type="lottery" onclick="triggerItemImageUpload(this)" onerror="this.src='https://placehold.co/48x48/F5F5F5/999?text=P'"></span>
                                    <div class="prize-card-title">Â•ñÂìÅ${i+1}</div>
                                </div>`).join('')}
                            </div>
                            <div class="carousel-indicator" style="text-align:center;margin-top:8px;">
                                <span style="font-size:10px;color:#999;">‚Üê Â∑¶Âè≥ÊªëÂä®Êü•ÁúãÊõ¥Â§öÂ•ñÂìÅ ‚Üí</span>
                            </div>
                        </div>`;
                    } else {
                        // ÁΩëÊ†ºÊ®°ÂºèÔºö3/6/9‰∏™
                        prizeGridHtml = `<div class="prize-grid" style="grid-template-rows:repeat(${Math.ceil(prizeCount/3)}, 1fr);">
                            ${Array.from({length: prizeCount}, (_, i) => `<div class="prize-card">
                                <span class="clickable-img-wrapper" style="border-radius:8px;"><img class="clickable-img" src="${comp.props.prizes[i] || 'assets/CodeBubbyAssets/45_550/'+(39+(i%6))+'.png'}" data-comp-id="${comp.id}" data-item-idx="${i}" data-img-type="lottery" onclick="triggerItemImageUpload(this)" onerror="this.src='https://placehold.co/48x48/F5F5F5/999?text=P'"></span>
                                <div class="prize-card-title">Â•ñÂìÅ${i+1}</div>
                            </div>`).join('')}
                        </div>`;
                    }
                    
                    return `<div class="module-card"><div class="lottery-header"><div class="module-title editable-text" contenteditable="true" style="color:${titleColor}">${comp.props.title}</div><div class="lottery-subtitle"><span class="editable-text" contenteditable="true">${comp.props.subtitle}</span><span style="color:#214CA5;cursor:pointer;">ÊàëÁöÑÂ•ñÂä±</span></div></div>${prizeGridHtml}<button class="lottery-btn" style="color:${txtColor}">${comp.props.buttonText}</button></div>`;
                case 'task':
                    return `<div class="module-card"><div class="module-title editable-text" contenteditable="true" style="color:${titleColor}">${comp.props.title}</div><div>${comp.props.tasks.map((t,i) => `<div class="task-item"><div class="task-info"><h4 class="editable-text" contenteditable="true">${t.name}</h4><p class="editable-text" contenteditable="true">${t.desc}</p></div><button class="task-btn ${i===0?'primary':''}" style="${i===0?'color:'+txtColor:''}">${t.btn}</button></div>`).join('')}</div></div>`;
                case 'event':
                    // Ê†πÊçÆÊï∞ÈáèÂÜ≥ÂÆöÂ∏ÉÂ±ÄÔºöÂçïÊï∞Áî®ÂçïÂàóÔºåÂèåÊï∞Áî®ÂèåÂàó
                    const eventCount = comp.props.events.length;
                    const isSingleColumn = eventCount % 2 !== 0;
                    const gridClass = isSingleColumn ? 'event-grid single-column' : 'event-grid';
                    return `<div class="module-card"><div class="module-title editable-text" contenteditable="true" style="color:${titleColor}">${comp.props.title}</div><div class="${gridClass}">${comp.props.events.map((ev,i) => `<div class="event-card clickable-event-card"><img class="clickable-img" src="${ev.image || 'assets/CodeBubbyAssets/45_550/'+(48+(i%4))+'.png'}" data-comp-id="${comp.id}" data-item-idx="${i}" data-img-type="event" onclick="triggerItemImageUpload(this)" onerror="this.src='https://placehold.co/160x80/667eea/fff?text=E'"><div class="event-overlay"><div class="event-title editable-text" contenteditable="true">${ev.title}</div><div class="event-desc editable-text" contenteditable="true">${ev.desc}</div></div><div class="event-replace-hint">ÁÇπÂáªÊõøÊç¢</div></div>`).join('')}</div></div>`;
                case 'progress':
                    return `<div class="module-card"><div class="module-title editable-text" contenteditable="true" style="color:${titleColor}">${comp.props.title}</div><p style="font-size:10px;color:rgba(60,60,67,0.76);margin-bottom:12px;" class="editable-text" contenteditable="true">${comp.props.subtitle}</p><div class="progress-container"><div class="progress-columns">${comp.props.milestones.map((m,i) => `<div class="progress-column"><span class="progress-label ${i<comp.props.current?'active':''}">${m}</span><div class="progress-segment ${i<comp.props.current?'completed':''}"><div class="progress-segment-fill"></div></div><div class="reward-tag ${i<comp.props.current?'claimable':''}">${i<comp.props.current?'ÂèØÈ¢ÜÂèñ':'Êú™È¢ÜÂèñ'}</div></div>`).join('')}</div></div></div>`;
                case 'image':
                    if (comp.props.imageUrl) {
                        return `<div class="module-card image-card"><img src="${comp.props.imageUrl}" style="width:100%;display:block;border-radius:12px;"></div>`;
                    } else {
                        return `<div class="module-card image-card image-placeholder" style="min-height:120px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;border-radius:12px;" onclick="triggerImageUpload('${comp.id}')"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg><div style="font-size:12px;color:#999;margin-top:8px;">ÁÇπÂáª‰∏ä‰º†ÂõæÁâá</div></div>`;
                    }
                case 'appDownload':
                    const appIconUrl = comp.props.iconUrl || 'assets/logo.png';
                    return `<div class="module-card app-download-card" style="padding:12px 16px;">
                        <div class="app-download-content" style="display:flex;align-items:center;gap:12px;">
                            <div class="app-icon-wrapper clickable-img-wrapper" style="width:48px;height:48px;border-radius:12px;overflow:hidden;flex-shrink:0;background:#f5f5f5;border:0.5px solid rgba(0,0,0,0.08);">
                                <img class="app-icon clickable-img" src="${appIconUrl}" style="width:100%;height:100%;object-fit:cover;" data-comp-id="${comp.id}" data-item-idx="0" data-img-type="appIcon" onclick="triggerItemImageUpload(this)" onerror="this.src='https://placehold.co/48x48/FEDF9C/F68910?text=APP'">
                            </div>
                            <div class="app-info" style="flex:1;min-width:0;">
                                <div class="app-name editable-text" contenteditable="true" style="font-size:15px;font-weight:600;color:#000;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${comp.props.appName || 'Â∫îÁî®ÂêçÁß∞'}</div>
                                <div class="app-desc editable-text" contenteditable="true" style="font-size:12px;color:#999;margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${comp.props.appDesc || 'Â∫îÁî®ÊèèËø∞'}</div>
                            </div>
                            <button class="app-download-btn" style="background:${customColors.primary};color:${txtColor};border:none;border-radius:20px;padding:8px 16px;font-size:13px;font-weight:500;white-space:nowrap;flex-shrink:0;">${comp.props.buttonText || 'Á´ãÂç≥‰∏ãËΩΩ'}</button>
                        </div>
                    </div>`;
                default:
                    return `<div class="module-card"><div class="module-title" style="color:${titleColor}">${comp.props.title||'ÁªÑ‰ª∂'}</div></div>`;
            }
        }
        
        // ÈáçÊéíÂ∫è
        function reorderComponents(draggedId, targetId) {
            const di = canvasComponents.findIndex(c => c.id === draggedId);
            const ti = canvasComponents.findIndex(c => c.id === targetId);
            if (di !== -1 && ti !== -1) {
                const [removed] = canvasComponents.splice(di, 1);
                canvasComponents.splice(ti, 0, removed);
                renderCanvas();
            }
        }
        
        // ÈÄâÊã©ÁªÑ‰ª∂
        function selectComponent(id) {
            selectedComponentId = id;
            document.querySelectorAll('.canvas-component').forEach(el => el.classList.toggle('selected', el.id === id));
            const comp = canvasComponents.find(c => c.id === id);
            if (comp) showPropertyEditor(comp);
        }
        
        // ÊòæÁ§∫Â±ûÊÄßÁºñËæëÂô®
        function showPropertyEditor(comp) {
            document.getElementById('propertyEmpty').style.display = 'none';
            document.getElementById('propertyEditor').style.display = 'block';
            document.getElementById('deleteButtonWrapper').style.display = 'block';
            document.getElementById('propTitle').value = comp.props.title || '';
            document.getElementById('propSubtitle').value = comp.props.subtitle || '';
            document.getElementById('propButtonText').value = comp.props.buttonText || '';
            
            // Êõ¥Êñ∞ÁªÑ‰ª∂ÂæΩÁ´†
            const componentNames = {
                hero: '‰∏ªËßÜËßâ', coupon: '‰ºòÊÉ†Âà∏', lottery: 'ÊäΩÂ•ñ', 
                task: '‰ªªÂä°ÂàóË°®', event: 'ÂõæÊñábanner', progress: 'ÈÇÄËØ∑Âä©Âäõ', image: 'Á∫ØÂõæÁâá',
                appDownload: 'ÂäüËÉΩÂØºÊµÅ'
            };
            const badge = document.getElementById('componentBadge');
            badge.textContent = componentNames[comp.type] || comp.type;
            badge.classList.add('active');
            
            // Êõ¥Êñ∞Ê≠•È™§ÊåáÂºï
            const stepGuides = {
                hero: { title: '‰∏ä‰º†‰∏ªËßÜËßâÁ¥†Êùê', desc: '‰∏ä‰º†ËßÜÈ¢ëÊàñÂõæÁâáÔºå‰Ωú‰∏∫È°µÈù¢È°∂ÈÉ®Â±ïÁ§∫' },
                coupon: { title: 'ÈÖçÁΩÆ‰ºòÊÉ†Âà∏', desc: 'ÁÇπÂáªÁîªÂ∏É‰∏≠ÁöÑÂõæÊ†áÂèØÊõøÊç¢ÔºåË∞ÉÊï¥Êï∞ÈáèÂíåÊñáÊ°à' },
                lottery: { title: 'ÈÖçÁΩÆÊäΩÂ•ñÊ®°Âùó', desc: 'ÈÄâÊã©Â∏ÉÂ±ÄÊñπÂºèÔºåÁÇπÂáªÂ•ñÂìÅÂõæÁâáÂèØÊõøÊç¢' },
                task: { title: 'ÈÖçÁΩÆ‰ªªÂä°ÂàóË°®', desc: 'Ë∞ÉÊï¥‰ªªÂä°Êï∞ÈáèÔºå‰øÆÊîπÊ†áÈ¢òÂíåÊåâÈíÆÊñáÊ°à' },
                event: { title: 'ÈÖçÁΩÆÊ¥ªÂä®ÂÖ•Âè£', desc: 'ÁÇπÂáªÊ¥ªÂä®ÂõæÁâáÂèØÊõøÊç¢Ôºå‰øÆÊîπÊ†áÈ¢òÊèèËø∞' },
                progress: { title: 'ÈÖçÁΩÆËøõÂ∫¶Âä©Âäõ', desc: 'Ë∞ÉÊï¥Èò∂ÊÆµÊï∞ÈáèÔºåËÆæÁΩÆÂä©ÂäõÁõÆÊ†á' },
                image: { title: '‰∏ä‰º†Â±ïÁ§∫ÂõæÁâá', desc: '‰∏ä‰º†ÈúÄË¶ÅÂ±ïÁ§∫ÁöÑÂõæÁâáÁ¥†Êùê' },
                appDownload: { title: 'ÈÖçÁΩÆAppÂØºÊµÅ', desc: 'ÁÇπÂáªÂõæÊ†áÂèØÊõøÊç¢Ôºå‰øÆÊîπÂ∫îÁî®ÂêçÁß∞ÂíåÊèèËø∞' }
            };
            const guide = stepGuides[comp.type] || { title: 'ÁºñËæëÁªÑ‰ª∂', desc: '‰øÆÊîπ‰∏ãÊñπÈÖçÁΩÆÈ°π' };
            document.getElementById('stepGuideTitle').textContent = guide.title;
            document.getElementById('stepGuideDesc').textContent = guide.desc;
            
            // Ê†πÊçÆÁªÑ‰ª∂Á±ªÂûãÊòæÁ§∫/ÈöêËóèÁºñËæëÂå∫
            const isHero = comp.type === 'hero';
            const isImage = comp.type === 'image';
            const isAppDownload = comp.type === 'appDownload';
            document.getElementById('heroEditorGroup').style.display = isHero ? 'block' : 'none';
            document.getElementById('imageEditorGroup').style.display = isImage ? 'block' : 'none';
            document.getElementById('appDownloadEditorGroup').style.display = isAppDownload ? 'block' : 'none';
            document.getElementById('textEditorGroup').style.display = (isHero || isImage || isAppDownload) ? 'none' : 'block';
            
            // ÂäüËÉΩÂØºÊµÅÁªÑ‰ª∂‰∏ìÂ±ûÂ±ûÊÄß
            if (isAppDownload) {
                document.getElementById('propAppName').value = comp.props.appName || '';
                document.getElementById('propAppDesc').value = comp.props.appDesc || '';
                document.getElementById('propAppButtonText').value = comp.props.buttonText || '';
            }
            
            // ÊåâÈíÆÊñáÂ≠óÈ°πÁâπÊÆäÂ§ÑÁêÜÔºàËøõÂ∫¶Êù°‰∏çÈúÄË¶ÅÊåâÈíÆÊñáÂ≠óÔºâ
            const needsButtonText = !['progress', 'appDownload'].includes(comp.type);
            const buttonTextItem = document.getElementById('buttonTextItem');
            if (buttonTextItem) {
                buttonTextItem.style.display = needsButtonText ? 'block' : 'none';
            }
            
            // ÂàóË°®ÈÖçÁΩÆÔºà‰ºòÊÉ†Âà∏„ÄÅ‰ªªÂä°ÂàóË°®„ÄÅÂõæÊñábannerÔºâ
            const hasListConfig = ['coupon', 'task', 'event'].includes(comp.type);
            document.getElementById('listCountGroup').style.display = hasListConfig ? 'block' : 'none';
            if (hasListConfig) {
                const count = getListCount(comp);
                document.getElementById('propListCount').value = count;
                document.getElementById('listCountHint').textContent = `ÂΩìÂâç${count}È°πÔºåÊúÄÂ§ö6È°π`;
            }
            
            // ËøõÂ∫¶Êù°Èò∂ÊÆµÈÖçÁΩÆ
            const isProgress = comp.type === 'progress';
            document.getElementById('progressStageGroup').style.display = isProgress ? 'block' : 'none';
            if (isProgress) {
                const stageCount = comp.props.milestones ? comp.props.milestones.length : 3;
                document.getElementById('propStageCount').value = stageCount;
                document.getElementById('stageCountHint').textContent = `ÂΩìÂâç${stageCount}Èò∂ÊÆµÔºå2-5ÂèØÈÄâ`;
            }
            
            // ÊäΩÂ•ñÂ∏ÉÂ±ÄÈÖçÁΩÆ
            const isLottery = comp.type === 'lottery';
            document.getElementById('lotteryLayoutGroup').style.display = isLottery ? 'block' : 'none';
            if (isLottery) {
                const layout = comp.props.layout || 6;
                // ÂêåÊ≠•ÂçïÈÄâÊåâÈíÆÁä∂ÊÄÅ
                document.querySelectorAll('input[name="lotteryLayout"]').forEach(radio => {
                    radio.checked = (radio.value === String(layout));
                });
                // ÊòæÁ§∫/ÈöêËóèËΩÆÊí≠Êï∞ÈáèÈÖçÁΩÆ
                const isCarousel = layout === 'carousel' || layout > 9;
                document.getElementById('lotteryCarouselCountGroup').style.display = isCarousel ? 'block' : 'none';
                if (isCarousel) {
                    const carouselCount = comp.props.prizes ? comp.props.prizes.length : 12;
                    document.getElementById('propLotteryCarouselCount').value = carouselCount > 9 ? carouselCount : 12;
                    document.getElementById('lotteryCarouselHint').textContent = `ÂΩìÂâç${carouselCount > 9 ? carouselCount : 12}‰∏™Ôºå10-20ÂèØÈÄâ`;
                }
            }
            
            // ‰∏ªËßÜËßâÈ¢ÑËßà
            if (isHero && comp.props.mediaUrl) {
                updateHeroPreview(comp.props.mediaType, comp.props.mediaUrl);
            } else {
                document.getElementById('heroMediaPreview').style.display = 'none';
            }
            
            // Á∫ØÂõæÁâáÈ¢ÑËßà
            if (isImage && comp.props.imageUrl) {
                updateImagePreview(comp.props.imageUrl);
            } else {
                document.getElementById('imagePreviewSection').style.display = 'none';
            }
        }
        
        // ÊäòÂè†Èù¢ÊùøÂàáÊç¢
        function toggleCollapsible(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.toggle('open');
            }
        }
        
        // Ëé∑ÂèñÂàóË°®Êï∞Èáè
        function getListCount(comp) {
            if (comp.type === 'coupon') return comp.props.items ? comp.props.items.length : 2;
            if (comp.type === 'task') return comp.props.tasks ? comp.props.tasks.length : 2;
            if (comp.type === 'event') return comp.props.events ? comp.props.events.length : 2;
            return 0;
        }
        
        // Ë∞ÉÊï¥ÂàóË°®Êï∞Èáè
        function adjustListCount(delta) {
            const input = document.getElementById('propListCount');
            const newValue = Math.max(1, Math.min(6, parseInt(input.value) + delta));
            input.value = newValue;
            setListCount(newValue);
        }
        
        // ËÆæÁΩÆÂàóË°®Êï∞Èáè
        function setListCount(count) {
            if (!selectedComponentId) return;
            const comp = canvasComponents.find(c => c.id === selectedComponentId);
            if (!comp) return;
            
            count = Math.max(1, Math.min(6, count));
            document.getElementById('propListCount').value = count;
            document.getElementById('listCountHint').textContent = `ÂΩìÂâç${count}È°πÔºåÊúÄÂ§ö6È°π`;
            
            if (comp.type === 'coupon') {
                const currentItems = comp.props.items || [];
                if (count > currentItems.length) {
                    for (let i = currentItems.length; i < count; i++) {
                        currentItems.push({ name: `‰ºòÊÉ†Âà∏${i + 1}`, tag: '‰∏ìÂ±ûÁ§º' });
                    }
                } else {
                    currentItems.length = count;
                }
                comp.props.items = currentItems;
            } else if (comp.type === 'task') {
                const currentTasks = comp.props.tasks || [];
                if (count > currentTasks.length) {
                    for (let i = currentTasks.length; i < count; i++) {
                        currentTasks.push({ name: `‰ªªÂä°${i + 1}`, desc: 'ÂÆåÊàê‰ªªÂä°Ëé∑ÂæóÂ•ñÂä±', btn: 'ÂâçÂæÄ' });
                    }
                } else {
                    currentTasks.length = count;
                }
                comp.props.tasks = currentTasks;
            } else if (comp.type === 'event') {
                const currentEvents = comp.props.events || [];
                if (count > currentEvents.length) {
                    for (let i = currentEvents.length; i < count; i++) {
                        currentEvents.push({ title: `Ê¥ªÂä®${i + 1}`, desc: 'Ê¥ªÂä®ÊèèËø∞' });
                    }
                } else {
                    currentEvents.length = count;
                }
                comp.props.events = currentEvents;
            }
            
            renderCanvas();
            showToast(`${count}È°π`);
        }
        
        // Ë∞ÉÊï¥ËøõÂ∫¶Êù°Èò∂ÊÆµÊï∞Èáè
        function adjustProgressStages(delta) {
            const input = document.getElementById('propStageCount');
            const newValue = Math.max(2, Math.min(5, parseInt(input.value) + delta));
            input.value = newValue;
            setProgressStages(newValue);
        }
        
        // ËÆæÁΩÆËøõÂ∫¶Êù°Èò∂ÊÆµÊï∞Èáè
        function setProgressStages(count) {
            if (!selectedComponentId) return;
            const comp = canvasComponents.find(c => c.id === selectedComponentId);
            if (!comp || comp.type !== 'progress') return;
            
            count = Math.max(2, Math.min(5, count));
            document.getElementById('propStageCount').value = count;
            document.getElementById('stageCountHint').textContent = `ÂΩìÂâç${count}Èò∂ÊÆµÔºå2-5ÂèØÈÄâ`;
            
            // ÈªòËÆ§Èò∂ÊÆµÊ†áÁ≠æ
            const defaultMilestones = ['1‰∫∫', '3‰∫∫', '5‰∫∫', '10‰∫∫', '15‰∫∫'];
            const currentMilestones = comp.props.milestones || [];
            
            if (count > currentMilestones.length) {
                // Â¢ûÂä†Èò∂ÊÆµ
                for (let i = currentMilestones.length; i < count; i++) {
                    currentMilestones.push(defaultMilestones[i] || `${(i + 1) * 5}‰∫∫`);
                }
            } else {
                // ÂáèÂ∞ëÈò∂ÊÆµ
                currentMilestones.length = count;
            }
            
            // Á°Æ‰øùcurrent‰∏çË∂ÖËøáÈò∂ÊÆµÊï∞
            if (comp.props.current > count) {
                comp.props.current = count;
            }
            
            comp.props.milestones = currentMilestones;
            renderCanvas();
            showToast(`${count}Èò∂ÊÆµ`);
        }
        
        // ËÆæÁΩÆÊäΩÂ•ñÂ∏ÉÂ±Ä
        function setLotteryLayout(layout) {
            if (!selectedComponentId) return;
            const comp = canvasComponents.find(c => c.id === selectedComponentId);
            if (!comp || comp.type !== 'lottery') return;
            
            const isCarousel = layout === 'carousel';
            comp.props.layout = isCarousel ? 'carousel' : parseInt(layout);
            
            // ÊòæÁ§∫/ÈöêËóèËΩÆÊí≠Êï∞ÈáèÈÖçÁΩÆ
            document.getElementById('lotteryCarouselCountGroup').style.display = isCarousel ? 'block' : 'none';
            
            // Ê†πÊçÆÂ∏ÉÂ±ÄË∞ÉÊï¥Â•ñÂìÅÊï∞ÁªÑÈïøÂ∫¶
            let targetCount = isCarousel ? 12 : parseInt(layout);
            if (!comp.props.prizes) comp.props.prizes = [];
            
            if (isCarousel && comp.props.prizes.length < 10) {
                // ËΩÆÊí≠Ê®°ÂºèÈªòËÆ§12‰∏™
                targetCount = 12;
            }
            
            // Ë∞ÉÊï¥Êï∞ÁªÑÈïøÂ∫¶
            while (comp.props.prizes.length < targetCount) {
                comp.props.prizes.push('');
            }
            if (!isCarousel) {
                comp.props.prizes.length = targetCount;
            }
            
            renderCanvas();
            
            const layoutNames = { 3: '3‰∏™', 6: '6‰∏™', 9: '9‰∏™', 'carousel': 'ËΩÆÊí≠' };
            showToast(`Â∏ÉÂ±ÄÔºö${layoutNames[layout] || layout}`);
        }
        
        // Ë∞ÉÊï¥ËΩÆÊí≠Â•ñÂìÅÊï∞Èáè
        function adjustLotteryCarouselCount(delta) {
            const input = document.getElementById('propLotteryCarouselCount');
            const newValue = Math.max(10, Math.min(20, parseInt(input.value) + delta));
            input.value = newValue;
            setLotteryCarouselCount(newValue);
        }
        
        // ËÆæÁΩÆËΩÆÊí≠Â•ñÂìÅÊï∞Èáè
        function setLotteryCarouselCount(count) {
            if (!selectedComponentId) return;
            const comp = canvasComponents.find(c => c.id === selectedComponentId);
            if (!comp || comp.type !== 'lottery') return;
            
            count = Math.max(10, Math.min(20, count));
            document.getElementById('propLotteryCarouselCount').value = count;
            document.getElementById('lotteryCarouselHint').textContent = `ÂΩìÂâç${count}‰∏™Ôºå10-20ÂèØÈÄâ`;
            
            // Ë∞ÉÊï¥Â•ñÂìÅÊï∞ÁªÑÈïøÂ∫¶
            if (!comp.props.prizes) comp.props.prizes = [];
            while (comp.props.prizes.length < count) {
                comp.props.prizes.push('');
            }
            comp.props.prizes.length = count;
            
            renderCanvas();
            showToast(`ËΩÆÊí≠Ôºö${count}‰∏™Â•ñÂìÅ`);
        }
        
        // Â§ÑÁêÜ‰∏ªËßÜËßâÂ™í‰Ωì‰∏ä‰º†
        function handleHeroMediaUpload(event) {
            const file = event.target.files[0];
            if (!file || !selectedComponentId) return;
            
            const comp = canvasComponents.find(c => c.id === selectedComponentId);
            if (!comp || comp.type !== 'hero') return;
            
            const isVideo = file.type.startsWith('video/');
            const reader = new FileReader();
            
            reader.onload = function(e) {
                comp.props.mediaType = isVideo ? 'video' : 'image';
                comp.props.mediaUrl = e.target.result;
                renderCanvas();
                updateHeroPreview(comp.props.mediaType, comp.props.mediaUrl);
                showToast('Â∑≤‰∏ä‰º†');
            };
            
            reader.readAsDataURL(file);
        }
        
        // Êõ¥Êñ∞‰∏ªËßÜËßâÈ¢ÑËßà
        function updateHeroPreview(type, url) {
            const container = document.getElementById('heroPreviewContainer');
            const previewSection = document.getElementById('heroMediaPreview');
            
            if (type === 'video') {
                container.innerHTML = `<video src="${url}" style="width:100%;display:block;" controls muted></video>`;
            } else {
                container.innerHTML = `<img src="${url}" style="width:100%;display:block;">`;
            }
            previewSection.style.display = 'block';
        }
        
        // Ê∏ÖÈô§‰∏ªËßÜËßâÂ™í‰Ωì
        function clearHeroMedia() {
            if (!selectedComponentId) return;
            const comp = canvasComponents.find(c => c.id === selectedComponentId);
            if (comp && comp.type === 'hero') {
                comp.props.mediaUrl = '';
                comp.props.mediaType = 'image';
                renderCanvas();
                document.getElementById('heroMediaPreview').style.display = 'none';
                document.getElementById('heroMediaInput').value = '';
                showToast('Â∑≤Ê∏ÖÈô§');
            }
        }
        
        // Â§ÑÁêÜÁ∫ØÂõæÁâá‰∏ä‰º†
        function handlePureImageUpload(event) {
            const file = event.target.files[0];
            if (!file || !selectedComponentId) return;
            
            const comp = canvasComponents.find(c => c.id === selectedComponentId);
            if (!comp || comp.type !== 'image') return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                comp.props.imageUrl = e.target.result;
                renderCanvas();
                updateImagePreview(comp.props.imageUrl);
                showToast('Â∑≤‰∏ä‰º†');
            };
            reader.readAsDataURL(file);
        }
        
        // Ëß¶ÂèëÁ∫ØÂõæÁâá‰∏ä‰º†Ôºà‰ªéÁîªÂ∏ÉÁÇπÂáªÔºâ
        function triggerImageUpload(compId) {
            selectComponent(compId);
            setTimeout(() => {
                document.getElementById('pureImageInput').click();
            }, 100);
        }
        
        // Êõ¥Êñ∞Á∫ØÂõæÁâáÈ¢ÑËßà
        function updateImagePreview(url) {
            const container = document.getElementById('imagePreviewContainer');
            const previewSection = document.getElementById('imagePreviewSection');
            container.innerHTML = `<img src="${url}" style="width:100%;display:block;">`;
            previewSection.style.display = 'block';
        }
        
        // Ê∏ÖÈô§Á∫ØÂõæÁâá
        function clearPureImage() {
            if (!selectedComponentId) return;
            const comp = canvasComponents.find(c => c.id === selectedComponentId);
            if (comp && comp.type === 'image') {
                comp.props.imageUrl = '';
                renderCanvas();
                document.getElementById('imagePreviewSection').style.display = 'none';
                document.getElementById('pureImageInput').value = '';
                showToast('Â∑≤Ê∏ÖÈô§');
            }
        }
        
        // Êõ¥Êñ∞Â±ûÊÄß
        function updateProp(prop, value) {
            if (!selectedComponentId) return;
            const comp = canvasComponents.find(c => c.id === selectedComponentId);
            if (comp) { comp.props[prop] = value; renderCanvas(); }
        }
        
        // Âà†Èô§ÁªÑ‰ª∂
        function deleteComponent(id) {
            canvasComponents = canvasComponents.filter(c => c.id !== id);
            if (selectedComponentId === id) {
                selectedComponentId = null;
                document.getElementById('propertyEmpty').style.display = 'flex';
                document.getElementById('propertyEditor').style.display = 'none';
                document.getElementById('deleteButtonWrapper').style.display = 'none';
                // ÈáçÁΩÆÂæΩÁ´†
                const badge = document.getElementById('componentBadge');
                badge.textContent = 'Êú™ÈÄâÊã©';
                badge.classList.remove('active');
            }
            renderCanvas();
            showToast('Â∑≤Âà†Èô§');
        }
        
        function deleteSelectedComponent() {
            if (selectedComponentId) deleteComponent(selectedComponentId);
        }
        
        // ÁÇπÂáªÂõæÁâáËß¶Âèë‰∏ä‰º†Ôºà‰ºòÊÉ†Âà∏„ÄÅÊäΩÂ•ñ„ÄÅÂõæÊñábannerÔºâ
        let currentUploadTarget = null;
        
        function triggerItemImageUpload(imgElement) {
            event.stopPropagation();
            currentUploadTarget = {
                compId: imgElement.dataset.compId,
                itemIdx: parseInt(imgElement.dataset.itemIdx),
                imgType: imgElement.dataset.imgType
            };
            
            // ÂàõÂª∫‰∏¥Êó∂input
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/png,image/jpeg,image/jpg';
            input.onchange = handleItemImageUpload;
            input.click();
        }
        
        function handleItemImageUpload(event) {
            const file = event.target.files[0];
            if (!file || !currentUploadTarget) return;
            
            const { compId, itemIdx, imgType } = currentUploadTarget;
            const comp = canvasComponents.find(c => c.id === compId);
            if (!comp) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                
                if (imgType === 'coupon') {
                    if (!comp.props.items[itemIdx]) return;
                    comp.props.items[itemIdx].icon = imageUrl;
                } else if (imgType === 'lottery') {
                    if (!comp.props.prizes) comp.props.prizes = [];
                    comp.props.prizes[itemIdx] = imageUrl;
                } else if (imgType === 'event') {
                    if (!comp.props.events[itemIdx]) return;
                    comp.props.events[itemIdx].image = imageUrl;
                } else if (imgType === 'appIcon') {
                    comp.props.iconUrl = imageUrl;
                }
                
                renderCanvas();
                showToast('Â∑≤ÊõøÊç¢');
                currentUploadTarget = null;
            };
            reader.readAsDataURL(file);
        }
        
        // Â§ÑÁêÜÂ∫îÁî®ÂõæÊ†á‰∏ä‰º†Ôºà‰ªéÂ±ûÊÄßÈù¢ÊùøÔºâ
        function handleAppIconUpload(event) {
            const file = event.target.files[0];
            if (!file || !selectedComponentId) return;
            
            const comp = canvasComponents.find(c => c.id === selectedComponentId);
            if (!comp || comp.type !== 'appDownload') return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                comp.props.iconUrl = e.target.result;
                renderCanvas();
                showToast('ÂõæÊ†áÂ∑≤Êõ¥Êñ∞');
            };
            reader.readAsDataURL(file);
        }
        
        // ÈÖçËâ≤ÊñπÊ°à
        function applyColorScheme(scheme) {
            currentColorScheme = scheme;
            customColors = { ...colorSchemes[scheme] };
            document.querySelectorAll('.color-preset').forEach(el => el.classList.toggle('active', el.dataset.scheme === scheme));
            document.getElementById('primaryColor').value = customColors.primary;
            document.getElementById('primaryHex').value = customColors.primary;
            document.getElementById('accentColor').value = customColors.accent;
            document.getElementById('accentHex').value = customColors.accent;
            document.getElementById('bgColor').value = customColors.background;
            document.getElementById('bgHex').value = customColors.background;
            
            // ÂêåÊ≠•ÊåâÈíÆÊñáÂ≠óÈ¢úËâ≤ÂçïÈÄâÊåâÈíÆ
            const btnTextRadios = document.querySelectorAll('input[name="btnTextColor"]');
            btnTextRadios.forEach(radio => {
                radio.checked = (radio.value === customColors.textColor);
            });
            
            applyColorsToCanvas();
            renderCanvas();
            showToast('Â∑≤Êõ¥Êñ∞');
        }
        
        // ËÆ°ÁÆóÈ¢úËâ≤‰∫ÆÂ∫¶ÔºåÂà§Êñ≠ÊòØÂê¶‰∏∫ÊµÖËâ≤
        function isLightColor(hexColor) {
            const hex = hexColor.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            // ‰ΩøÁî®Áõ∏ÂØπ‰∫ÆÂ∫¶ÂÖ¨Âºè
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
            return luminance > 0.5;
        }
        
        // Ê†πÊçÆ‰∏ªËâ≤Ëá™Âä®ËÆ°ÁÆóÊñáÂ≠óÈ¢úËâ≤
        function getAutoTextColor(primaryColor) {
            return isLightColor(primaryColor) ? '#000000' : '#ffffff';
        }
        
        function updateCustomColor(type, value) {
            const hexInput = document.getElementById(type === 'primary' ? 'primaryHex' : type === 'accent' ? 'accentHex' : 'bgHex');
            if (hexInput) hexInput.value = value;
        }
        
        function updateColorFromHex(type, value) {
            if (/^#[0-9A-Fa-f]{6}$/.test(value)) {
                const colorInput = document.getElementById(type === 'primary' ? 'primaryColor' : type === 'accent' ? 'accentColor' : 'bgColor');
                if (colorInput) colorInput.value = value;
            }
        }
        
        // Â∫îÁî®Ëá™ÂÆö‰πâÈ¢úËâ≤ÔºàÁÇπÂáªÁ°ÆËÆ§ÊåâÈíÆÊó∂Ë∞ÉÁî®Ôºâ
        function applyCustomColors() {
            const primary = document.getElementById('primaryColor').value;
            const accent = document.getElementById('accentColor').value;
            const background = document.getElementById('bgColor').value;
            
            customColors.primary = primary;
            customColors.accent = accent;
            customColors.background = background;
            // ‰ªéÂçïÈÄâÊåâÈíÆËé∑ÂèñÊåâÈíÆÊñáÂ≠óÈ¢úËâ≤
            const checkedRadio = document.querySelector('input[name="btnTextColor"]:checked');
            customColors.textColor = checkedRadio ? checkedRadio.value : '#000000';
            
            // ÂêåÊ≠•hexËæìÂÖ•Ê°Ü
            document.getElementById('primaryHex').value = primary;
            document.getElementById('accentHex').value = accent;
            document.getElementById('bgHex').value = background;
            
            // Ê∏ÖÈô§È¢ÑËÆæÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.color-preset').forEach(el => el.classList.remove('active'));
            
            applyColorsToCanvas();
            showToast('Â∑≤Â∫îÁî®');
        }
        
        function applyColorsToCanvas() {
            // Âè™Êõ¥Êñ∞ÊâãÊú∫Ê°ÜÂÜÖÁîªÂ∏ÉÁöÑÈ¢úËâ≤Ôºå‰∏çÂΩ±ÂìçÂ§ñÈÉ®UI
            const canvas = document.getElementById('canvasContent');
            canvas.style.background = customColors.background;
            
            const txtColor = customColors.textColor || '#000';
            
            canvas.querySelectorAll('.coupon-btn, .lottery-btn, .task-btn.primary, .app-download-btn').forEach(el => {
                el.style.background = customColors.primary;
                el.style.color = txtColor;
            });
            canvas.querySelectorAll('.coupon-item').forEach(el => {
                el.style.background = customColors.btnBg || customColors.primary + '33';
            });
            canvas.querySelectorAll('.progress-segment-fill, .reward-tag.claimable').forEach(el => {
                el.style.background = customColors.accent;
            });
            // ËøõÂ∫¶Êù°ÂÆπÂô®ËÉåÊôØËâ≤‰∏é‰ºòÊÉ†Âà∏ËÉåÊôØËâ≤ËÅîÂä®
            canvas.querySelectorAll('.progress-container').forEach(el => {
                el.style.background = customColors.btnBg || customColors.primary + '33';
            });
            // Ê®°ÂùóÊ†áÈ¢òÂõ∫ÂÆö‰∏∫ÈªëËâ≤Ôºå‰∏çÈöèÈÖçËâ≤ÊñπÊ°àÊîπÂèò
            canvas.querySelectorAll('.module-title').forEach(el => {
                el.style.color = '#000';
            });
            
            // Êõ¥Êñ∞Â∑¶‰æßÁªÑ‰ª∂Áº©Áï•ÂõæÁöÑÈÖçËâ≤
            updateComponentThumbnails();
        }
        
        // Êõ¥Êñ∞ÊåâÈíÆÊñáÂ≠óÈ¢úËâ≤ÔºàÂÖ®Â±ÄÈÖçÁΩÆÔºâ
        function updateButtonTextColor(color) {
            customColors.textColor = color;
            applyColorsToCanvas();
            renderCanvas();
            showToast(color === '#000000' ? 'ÈªëËâ≤ÊñáÂ≠ó' : 'ÁôΩËâ≤ÊñáÂ≠ó');
        }
        
        // Êõ¥Êñ∞Â∑¶‰æßÁªÑ‰ª∂Áº©Áï•ÂõæÈÖçËâ≤
        function updateComponentThumbnails() {
            const grid = document.getElementById('componentGrid');
            if (!grid) return;
            
            grid.querySelectorAll('.component-card').forEach(card => {
                const type = card.dataset.type;
                const thumb = card.querySelector('.component-thumb');
                if (thumb) {
                    thumb.innerHTML = getComponentThumbnailWithColors(type);
                }
            });
        }
        
        // Ëé∑ÂèñÂ∏¶ÂΩìÂâçÈÖçËâ≤ÁöÑÁº©Áï•ÂõæHTML
        function getComponentThumbnailWithColors(type) {
            const primary = customColors.primary;
            const accent = customColors.accent;
            const btnBg = customColors.btnBg || primary + '33';
            
            const thumbs = {
                hero: `<div style="width:100%;height:100%;background:${primary};display:flex;align-items:center;justify-content:center;border-radius:6px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.5"><rect x="2" y="2" width="20" height="20" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
                </div>`,
                coupon: `<div style="width:100%;height:100%;background:${btnBg};border-radius:6px;padding:6px;display:flex;flex-direction:column;gap:4px;">
                    <div style="flex:1;background:${primary};border-radius:4px;display:flex;align-items:center;padding:0 6px;">
                        <div style="width:12px;height:12px;background:${accent};border-radius:2px;margin-right:4px;"></div>
                        <div style="flex:1;height:4px;background:rgba(0,0,0,0.1);border-radius:2px;"></div>
                        <div style="width:20px;height:10px;background:${accent};border-radius:8px;margin-left:4px;"></div>
                    </div>
                    <div style="flex:1;background:${primary};border-radius:4px;display:flex;align-items:center;padding:0 6px;">
                        <div style="width:12px;height:12px;background:${accent};border-radius:2px;margin-right:4px;"></div>
                        <div style="flex:1;height:4px;background:rgba(0,0,0,0.1);border-radius:2px;"></div>
                        <div style="width:20px;height:10px;background:${accent};border-radius:8px;margin-left:4px;"></div>
                    </div>
                </div>`,
                lottery: `<div style="width:100%;height:100%;background:${btnBg};border-radius:6px;padding:6px;display:flex;flex-direction:column;gap:4px;">
                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:3px;flex:1;">
                        <div style="background:#f5f5f5;border-radius:3px;"></div>
                        <div style="background:#f5f5f5;border-radius:3px;"></div>
                        <div style="background:#f5f5f5;border-radius:3px;"></div>
                        <div style="background:#f5f5f5;border-radius:3px;"></div>
                        <div style="background:#f5f5f5;border-radius:3px;"></div>
                        <div style="background:#f5f5f5;border-radius:3px;"></div>
                    </div>
                    <div style="height:12px;background:${primary};border-radius:4px;"></div>
                </div>`,
                task: `<div style="width:100%;height:100%;background:#fff;border-radius:6px;padding:6px;display:flex;flex-direction:column;gap:4px;">
                    <div style="display:flex;align-items:center;gap:4px;">
                        <div style="flex:1;height:4px;background:#ddd;border-radius:2px;"></div>
                        <div style="width:20px;height:10px;background:${primary};border-radius:8px;"></div>
                    </div>
                    <div style="display:flex;align-items:center;gap:4px;">
                        <div style="flex:1;height:4px;background:#ddd;border-radius:2px;"></div>
                        <div style="width:20px;height:10px;background:#f0f0f0;border-radius:8px;"></div>
                    </div>
                    <div style="display:flex;align-items:center;gap:4px;">
                        <div style="flex:1;height:4px;background:#ddd;border-radius:2px;"></div>
                        <div style="width:20px;height:10px;background:#f0f0f0;border-radius:8px;"></div>
                    </div>
                </div>`,
                event: `<div style="width:100%;height:100%;background:#fff;border-radius:6px;padding:4px;display:grid;grid-template-columns:1fr 1fr;gap:4px;">
                    <div style="background:#667eea;border-radius:4px;position:relative;overflow:hidden;">
                        <div style="position:absolute;bottom:0;left:0;right:0;height:50%;background:rgba(0,0,0,0.3);"></div>
                    </div>
                    <div style="background:#11998e;border-radius:4px;position:relative;overflow:hidden;">
                        <div style="position:absolute;bottom:0;left:0;right:0;height:50%;background:rgba(0,0,0,0.3);"></div>
                    </div>
                </div>`,
                progress: `<div style="width:100%;height:100%;background:${btnBg};border-radius:6px;padding:8px 6px;display:flex;flex-direction:column;justify-content:center;gap:6px;">
                    <div style="display:flex;gap:4px;">
                        <div style="flex:1;height:4px;background:${accent};border-radius:2px;"></div>
                        <div style="flex:1;height:4px;background:rgba(0,0,0,0.1);border-radius:2px;"></div>
                        <div style="flex:1;height:4px;background:rgba(0,0,0,0.1);border-radius:2px;"></div>
                    </div>
                    <div style="display:flex;justify-content:space-between;">
                        <div style="width:16px;height:8px;background:${accent};border-radius:4px;"></div>
                        <div style="width:16px;height:8px;background:rgba(0,0,0,0.1);border-radius:4px;"></div>
                        <div style="width:16px;height:8px;background:rgba(0,0,0,0.1);border-radius:4px;"></div>
                    </div>
                </div>`,
                image: `<div style="width:100%;height:100%;background:#fff;border-radius:6px;display:flex;align-items:center;justify-content:center;border:1px dashed #ddd;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
                </div>`,
                appDownload: `<div style="width:100%;height:100%;background:#fff;border-radius:6px;padding:8px;display:flex;align-items:center;gap:6px;box-sizing:border-box;">
                    <div style="width:28px;height:28px;background:${primary};border-radius:6px;flex-shrink:0;"></div>
                    <div style="flex:1;min-width:0;display:flex;flex-direction:column;gap:4px;">
                        <div style="height:6px;background:#333;border-radius:3px;width:70%;"></div>
                        <div style="height:4px;background:#ddd;border-radius:2px;width:90%;"></div>
                    </div>
                    <div style="width:28px;height:16px;background:${accent};border-radius:8px;flex-shrink:0;"></div>
                </div>`,
                banner: `<div style="width:100%;height:100%;background:${btnBg};border-radius:6px;display:flex;align-items:center;justify-content:center;">
                    <div style="width:80%;height:60%;background:${accent};border-radius:4px;opacity:0.8;"></div>
                </div>`
            };
            return thumbs[type] || '<div style="width:100%;height:100%;background:#f5f5f5;border-radius:6px;"></div>';
        }
        
        // ÂõæÁâá‰∏ä‰º†
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file && selectedComponentId) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const comp = canvasComponents.find(c => c.id === selectedComponentId);
                    if (comp) {
                        comp.props.imageUrl = e.target.result;
                        renderCanvas();
                        showToast('Â∑≤ÊõøÊç¢');
                    }
                };
                reader.readAsDataURL(file);
            }
        }
        
        // ‰øùÂ≠òÈÖçÁΩÆ
        function saveConfig() {
            const config = { components: canvasComponents, colors: customColors, scheme: currentColorScheme };
            localStorage.setItem('platformConfig', JSON.stringify(config));
            showToast('Â∑≤‰øùÂ≠ò');
        }
        
        // Âä†ËΩΩÈÖçÁΩÆ
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('platformConfig');
            if (saved) {
                try {
                    const config = JSON.parse(saved);
                    canvasComponents = config.components || [];
                    customColors = config.colors || colorSchemes.gold;
                    currentColorScheme = config.scheme || 'gold';
                    componentIdCounter = canvasComponents.length;
                    
                    document.getElementById('primaryColor').value = customColors.primary;
                    document.getElementById('primaryHex').value = customColors.primary;
                    document.getElementById('accentColor').value = customColors.accent;
                    document.getElementById('accentHex').value = customColors.accent;
                    document.getElementById('bgColor').value = customColors.background;
                    document.getElementById('bgHex').value = customColors.background;
                    document.querySelectorAll('.color-preset').forEach(el => el.classList.toggle('active', el.dataset.scheme === currentColorScheme));
                    
                    // ÂêåÊ≠•ÊåâÈíÆÊñáÂ≠óÈ¢úËâ≤ÂçïÈÄâÊåâÈíÆ
                    if (customColors.textColor) {
                        const btnTextRadios = document.querySelectorAll('input[name="btnTextColor"]');
                        btnTextRadios.forEach(radio => {
                            radio.checked = (radio.value === customColors.textColor);
                        });
                    }
                    
                    renderCanvas();
                } catch(e) { console.error('Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•', e); }
            }
        }
        
        // È¢ÑËßà
        function previewPage() {
            const modal = document.getElementById('previewModal');
            const content = document.getElementById('previewContent');
            content.innerHTML = document.getElementById('canvasContent').innerHTML;
            content.style.background = customColors.background;
            modal.classList.add('active');
        }
        
        function closePreview() {
            document.getElementById('previewModal').classList.remove('active');
        }
        
        // ÂØºÂá∫HTML
        function exportHTML() {
            const canvasHTML = document.getElementById('canvasContent').innerHTML;
            const styles = `<style>:root{--primary-gold:${customColors.primary};--primary-orange:${customColors.accent};--primary-yellow:${customColors.background};}body{font-family:'PingFang SC',sans-serif;background:${customColors.background};margin:0;padding:0;}${document.querySelector('style').textContent}</style>`;
            
            const html = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËøêËê•Ê¥ªÂä®È°µÈù¢</title>
    ${styles}
</head>
<body>
    <div style="max-width:430px;margin:0 auto;min-height:100vh;background:${customColors.background};">
        ${canvasHTML}
    </div>
</body>
</html>`;
            
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ËøêËê•Ê¥ªÂä®È°µÈù¢.html';
            a.click();
            URL.revokeObjectURL(url);
            showToast('HTMLÂ∑≤ÂØºÂá∫');
        }
        
        // ToastÊèêÁ§∫
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        /* ‰∏ªÈ¢òÂàáÊç¢ */
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            localStorage.setItem('easydesign_theme', next);
        }
    </script>

    <!-- Â∑¶‰∏ãËßí‰∏ªÈ¢òÂàáÊç¢ -->
    <div class="theme-switch-wrapper" style="position:fixed;bottom:20px;left:20px;z-index:999;display:flex;align-items:center;gap:10px;background:var(--bg-secondary);border:1px solid var(--border);border-radius:24px;padding:6px 16px 6px 14px;box-shadow:0 4px 16px rgba(0,0,0,0.25);cursor:pointer;" onclick="toggleTheme()">
        <span style="font-size:13px;font-weight:600;color:var(--text-primary);white-space:nowrap;" id="themeLabel">Ê∑±Ëâ≤È£éÊ†º</span>
        <div class="theme-toggle-btn" id="themeToggle" style="position:relative;width:48px;height:26px;border-radius:13px;flex-shrink:0;">
            <div class="theme-toggle-thumb"></div>
        </div>
    </div>
    <script>
        function updateThemeLabel() {
            var label = document.getElementById('themeLabel');
            if (label) label.textContent = document.documentElement.getAttribute('data-theme') === 'light' ? 'ÊµÖËâ≤È£éÊ†º' : 'Ê∑±Ëâ≤È£éÊ†º';
        }
        updateThemeLabel();
        var _origToggle = toggleTheme;
        toggleTheme = function() { _origToggle(); updateThemeLabel(); };
    </script>
</body>
</html>
